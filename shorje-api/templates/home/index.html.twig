{% extends 'base.html.twig' %}

{% block title %}Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ø´ÙˆØ±Ø¬ÙŠ - Ø³ÙˆÙ‚ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†{% endblock %}

{% block body %}
<style>
    /* Custom CSS for Modern Arabic Marketplace - Responsive */
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    
    .category-btn {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        white-space: nowrap;
        position: relative;
        overflow: hidden;
    }
    
    .category-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }
    
    .category-btn:hover::before {
        left: 100%;
    }
    
    .category-btn:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    
    .category-btn:active {
        transform: scale(0.98);
    }
    
    #categorySlider {
        scroll-behavior: smooth;
    }
    
    /* Responsive Design */
    @media (max-width: 640px) {
        .category-btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .category-btn:hover {
            transform: translateY(-2px) scale(1.01);
        }
        
        .product-card {
            margin-bottom: 1rem;
        }
        
        .hero-slide h1 {
            font-size: 1.5rem;
            line-height: 1.2;
        }
        
        .hero-slide p {
            font-size: 0.875rem;
        }
        
        .hero-slide .btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
    }
    
    @media (max-width: 480px) {
        .category-btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }
        
        .hero-slide h1 {
            font-size: 1.25rem;
        }
        
        .hero-slide p {
            font-size: 0.75rem;
        }
        
        .hero-slide .btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }
    }
    
    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {
        .category-btn:hover {
            transform: none;
        }
        
        .product-card:hover {
            transform: none;
        }
    }
    
    /* Hero Slider Styles */
    .hero-slide {
        transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        transform: translateX(100%);
        opacity: 0;
    }
    
    .hero-slide.active {
        transform: translateX(0);
        opacity: 1;
    }
    
    /* Product Card Hover Effects */
    .product-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }
    
    .product-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1;
    }
    
    .product-card:hover::before {
        opacity: 1;
    }
    
    .product-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    
    /* Search Bar Animation */
    .search-container {
        position: relative;
        overflow: hidden;
    }
    
    .search-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.1), transparent);
        transition: left 0.6s;
    }
    
    .search-container:focus-within::before {
        left: 100%;
    }
    
    /* Floating Action Button - Responsive */
    .fab {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        animation: float 3s ease-in-out infinite;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    @media (min-width: 640px) {
        .fab {
            bottom: 30px;
            right: 30px;
        }
    }
    
    @media (min-width: 1024px) {
        .fab {
            bottom: 40px;
            right: 40px;
        }
    }
    
    .fab-text {
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s ease;
        pointer-events: none;
    }
    
    .fab:hover .fab-text {
        opacity: 1;
        transform: translateY(0);
    }
    
    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {
        .fab-text {
            opacity: 1;
            transform: translateY(0);
        }
        
        .fab:hover .fab-text {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }
    
    /* Gradient Text */
    .gradient-text {
        background: linear-gradient(135deg, #22c55e, #3b82f6, #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    /* Pulse Animation for Loading */
    .pulse-dot {
        animation: pulse 1.5s ease-in-out infinite;
    }
    
    .pulse-dot:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .pulse-dot:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 0.4; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.1); }
    }
    
    /* Seller Card Hover */
    .seller-card {
        transition: all 0.3s ease;
        position: relative;
    }
    
    .seller-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: inherit;
    }
    
    .seller-card:hover::after {
        opacity: 1;
    }
    
    .seller-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }
    
    /* Custom Scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #22c55e, #3b82f6);
        border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #16a34a, #2563eb);
    }
    
    /* Glass Morphism Effect */
    .glass {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
    }
    
    .glass-dark {
        background: rgba(15, 23, 42, 0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Line clamp utilities */
    .line-clamp-1 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
    }
    
    .line-clamp-2 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
    }
    
    .line-clamp-3 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 3;
    }
    
    /* Enhanced Product Card Animations - Responsive */
    .product-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }
    
    .product-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.03) 0%, rgba(59, 130, 246, 0.03) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1;
        pointer-events: none;
    }
    
    .product-card:hover::before {
        opacity: 1;
    }
    
    .product-card:hover {
        transform: translateY(-6px) scale(1.02);
        box-shadow: 0 20px 40px -8px rgba(0, 0, 0, 0.15);
    }
    
    @media (min-width: 640px) {
        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -10px rgba(0, 0, 0, 0.2);
        }
    }
    
    @media (min-width: 1024px) {
        .product-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.25);
        }
    }
    
    .product-card img {
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .product-card:hover img {
        transform: scale(1.08);
    }
    
    @media (min-width: 640px) {
        .product-card:hover img {
            transform: scale(1.1);
        }
    }
    
    @media (min-width: 1024px) {
        .product-card:hover img {
            transform: scale(1.12);
        }
    }
    
    /* Enhanced button hover effects */
    .product-card button {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .product-card button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {
        .product-card:hover {
            transform: none;
        }
        
        .product-card:hover img {
            transform: none;
        }
    }
    
    /* Enhanced Button Animations - Responsive */
    button {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    button:hover {
        transform: translateY(-1px);
    }
    
    @media (min-width: 640px) {
        button:hover {
            transform: translateY(-2px);
        }
    }
    
    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {
        button:hover {
            transform: none;
        }
    }
    
    button:active {
        transform: translateY(0);
    }
    
    /* Search Input Enhancements */
    #searchInput:focus {
        transform: scale(1.02);
    }
    
    /* Loading Animation */
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    /* Smooth Transitions */
    * {
        transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-green-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900">
    <!-- Include Home Navigation -->
    {% include 'components/home_navigation.html.twig' %}

    <!-- Hero Slider Section -->
    <section class="relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-2 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 md:py-8 lg:py-12">
            <!-- Hero Slider Container -->
            <div class="relative bg-gradient-to-br from-slate-900 via-blue-900 to-purple-900 rounded-xl sm:rounded-2xl md:rounded-3xl overflow-hidden shadow-2xl">
                <!-- Slider Slides -->
                <div class="relative h-48 sm:h-64 md:h-80 lg:h-96 xl:h-[500px]">
                    {% if sliderImages|length > 0 %}
                        {% for sliderImage in sliderImages %}
                            <div class="hero-slide {% if loop.first %}active{% endif %} absolute inset-0 flex items-center">
                                {% if sliderImage.image %}
                                    <div class="absolute inset-0 bg-cover bg-center bg-no-repeat" style="background-image: url('data:{{ sliderImage.imageMimeType }};base64,{{ sliderImage.image }}');">
                                        <div class="absolute inset-0 bg-gradient-to-r from-black/50 via-black/30 to-black/50"></div>
                                    </div>
                                {% else %}
                                    <div class="absolute inset-0 bg-gradient-to-r from-slate-600/20 via-blue-600/20 to-purple-600/20"></div>
                                {% endif %}
                                <div class="relative z-10 max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 md:gap-6 lg:gap-8 items-center">
                                    <div class="text-white text-center lg:text-right">
                                        {% if sliderImage.title %}
                                            <div class="inline-flex items-center bg-white/10 backdrop-blur-sm rounded-full px-2 sm:px-3 md:px-4 py-1 sm:py-2 mb-3 sm:mb-4 md:mb-6">
                                                <span class="text-sm sm:text-lg md:text-xl lg:text-2xl ml-1 sm:ml-2">ğŸ‰</span>
                                                <span class="text-xs sm:text-sm font-medium">{{ sliderImage.title }}</span>
                                            </div>
                                        {% endif %}
                                        <h1 class="text-xl sm:text-2xl md:text-3xl lg:text-4xl xl:text-6xl font-bold mb-3 sm:mb-4 md:mb-6 leading-tight">
                                            {% if sliderImage.title %}{{ sliderImage.title }}{% else %}Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø´ÙˆØ±Ø¬ÙŠ{% endif %}
                                        </h1>
                                        {% if sliderImage.description %}
                                            <p class="text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl text-blue-100 mb-4 sm:mb-6 md:mb-8 max-w-2xl leading-relaxed mx-auto lg:mx-0">
                                                {{ sliderImage.description }}
                                            </p>
                                        {% endif %}
                                        <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 md:gap-4 justify-center lg:justify-start">
                                            {% if sliderImage.buttonText and sliderImage.buttonUrl %}
                                                <a href="{{ sliderImage.buttonUrl }}" class="bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600 text-white px-4 sm:px-6 md:px-8 py-2 sm:py-3 md:py-4 rounded-lg sm:rounded-xl md:rounded-2xl font-semibold text-xs sm:text-sm md:text-base lg:text-lg transition-all duration-300 transform hover:scale-105 shadow-xl">
                                                    <i class="fas fa-arrow-left ml-1 sm:ml-2"></i>
                                                    {{ sliderImage.buttonText }}
                                                </a>
                                            {% endif %}
                                            {% if sliderImage.buttonText2 and sliderImage.buttonUrl2 %}
                                                <a href="{{ sliderImage.buttonUrl2 }}" class="bg-white/10 backdrop-blur-sm border border-white/20 text-white px-4 sm:px-6 md:px-8 py-2 sm:py-3 md:py-4 rounded-lg sm:rounded-xl md:rounded-2xl font-semibold text-xs sm:text-sm md:text-base lg:text-lg hover:bg-white/20 transition-all duration-300">
                                                    <i class="fas fa-arrow-left ml-1 sm:ml-2"></i>
                                                    {{ sliderImage.buttonText2 }}
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="hidden lg:block">
                                        <div class="relative">
                                            {% if sliderImage.image %}
                                                <div class="w-80 h-80 mx-auto bg-cover bg-center bg-no-repeat rounded-3xl shadow-2xl" style="background-image: url('data:{{ sliderImage.imageMimeType }};base64,{{ sliderImage.image }}');"></div>
                                            {% else %}
                                                <div class="w-80 h-80 mx-auto bg-gradient-to-br from-emerald-500/20 to-blue-500/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                                                    <i class="fas fa-store text-white text-8xl"></i>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <!-- Default slide when no slider images -->
                        <div class="hero-slide active absolute inset-0 flex items-center">
                            <div class="absolute inset-0 bg-gradient-to-r from-emerald-600/20 via-blue-600/20 to-purple-600/20"></div>
                            <div class="relative z-10 max-w-7xl mx-auto px-8 grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                                <div class="text-white">
                                    <div class="inline-flex items-center bg-white/10 backdrop-blur-sm rounded-full px-4 py-2 mb-6">
                                        <span class="text-2xl ml-2">ğŸ‰</span>
                                        <span class="text-sm font-medium">{{ 'app.welcome'|trans }}</span>
                                    </div>
                                    <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">
                                        {{ 'app.hero_title'|trans }}
                                        <span class="block text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-blue-400">
                                            {{ 'app.hero_subtitle'|trans }}
                                        </span>
                                    </h1>
                                    <p class="text-xl text-blue-100 mb-8 max-w-2xl leading-relaxed">
                                        {{ 'app.hero_description'|trans }}
                                    </p>
                                    <div class="flex flex-col sm:flex-row gap-4">
                                        <button onclick="goToMyProducts()" class="bg-white/10 backdrop-blur-sm text-white px-8 py-4 rounded-2xl font-bold text-lg hover:bg-white/20 transition-all duration-300 border border-white/20">
                                            <i class="fas fa-plus ml-2"></i>Ø¨ÙŠØ¹ Ù…Ù†ØªØ¬Ùƒ
                                        </button>
                                    </div>
                                </div>
                                <div class="hidden lg:block">
                                    <div class="relative">
                                        <div class="w-80 h-80 mx-auto bg-gradient-to-br from-emerald-400/20 to-blue-400/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                                            <i class="fas fa-store text-8xl text-white/80"></i>
                                        </div>
                                        <div class="absolute -top-4 -right-4 w-24 h-24 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg">
                                            <i class="fas fa-star text-white text-2xl"></i>
                                        </div>
                                        <div class="absolute -bottom-4 -left-4 w-20 h-20 bg-gradient-to-br from-pink-400 to-red-500 rounded-full flex items-center justify-center shadow-lg">
                                            <i class="fas fa-heart text-white text-xl"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- Slider Navigation -->
                <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-4">
                    {% if sliderImages|length > 0 %}
                        {% for sliderImage in sliderImages %}
                            <button onclick="changeSlide({{ loop.index0 }})" class="slider-dot {% if loop.first %}active{% endif %} w-4 h-4 bg-white rounded-full shadow-lg transition-all duration-300"></button>
                        {% endfor %}
                    {% else %}
                        <button onclick="changeSlide(0)" class="slider-dot active w-4 h-4 bg-white rounded-full shadow-lg transition-all duration-300"></button>
                    {% endif %}
                </div>

                <!-- Navigation Arrows -->
                <button onclick="previousSlide()" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/10 backdrop-blur-sm text-white p-3 rounded-full hover:bg-white/20 transition-all duration-300">
                    <i class="fas fa-chevron-right text-xl"></i>
                </button>
                <button onclick="nextSlide()" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/10 backdrop-blur-sm text-white p-3 rounded-full hover:bg-white/20 transition-all duration-300">
                    <i class="fas fa-chevron-left text-xl"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- Category Filters Section -->
    <section class="py-6 sm:py-8 md:py-10 lg:py-12 bg-gradient-to-br from-white via-blue-50/30 to-emerald-50/30">
        <div class="max-w-7xl mx-auto px-2 sm:px-4 md:px-6 lg:px-8">
            <!-- Section Header -->
            <div class="text-center mb-6 sm:mb-8 md:mb-10 lg:mb-12">
                <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2 sm:mb-3 md:mb-4">
                    ØªØµÙØ­ Ø­Ø³Ø¨
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-500 to-blue-500">Ø§Ù„ÙØ¦Ø§Øª</span>
                </h2>
                <p class="text-sm sm:text-base md:text-lg lg:text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                    Ø§ÙƒØªØ´Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªÙ†ÙˆØ¹Ø© Ù…Ù† Ù…Ø®ØªÙ„Ù Ø§Ù„ÙØ¦Ø§Øª
                </p>
            </div>

            <!-- Category Grid -->
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 sm:gap-4 md:gap-6 mb-6 sm:mb-8 md:mb-10 lg:mb-12">
                <!-- All Categories -->
                <button onclick="filterByCategory('all')" 
                        class="category-card group bg-gradient-to-br from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white p-3 sm:p-4 md:p-6 rounded-lg sm:rounded-xl md:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105" 
                        data-category="all">
                    <div class="text-center">
                        <div class="w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 bg-white/20 rounded-lg sm:rounded-xl md:rounded-2xl flex items-center justify-center mx-auto mb-2 sm:mb-3 md:mb-4 group-hover:bg-white/30 transition-colors">
                            <i class="fas fa-th-large text-lg sm:text-xl md:text-2xl"></i>
                        </div>
                        <h3 class="font-bold text-sm sm:text-base md:text-lg">Ø§Ù„ÙƒÙ„</h3>
                        <p class="text-xs sm:text-sm opacity-90 mt-1">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</p>
                    </div>
                </button>

                <!-- Cars -->
                <button onclick="filterByCategory('car')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-blue-50 hover:to-cyan-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-3 sm:p-4 md:p-6 rounded-lg sm:rounded-xl md:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="car">
                    <div class="text-center">
                        <div class="w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900 dark:to-cyan-900 rounded-lg sm:rounded-xl md:rounded-2xl flex items-center justify-center mx-auto mb-2 sm:mb-3 md:mb-4 group-hover:from-blue-200 group-hover:to-cyan-200 dark:group-hover:from-blue-800 dark:group-hover:to-cyan-800 transition-colors">
                            <i class="fas fa-car text-lg sm:text-xl md:text-2xl text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <h3 class="font-bold text-sm sm:text-base md:text-lg text-gray-900 dark:text-white">Ø³ÙŠØ§Ø±Ø§Øª</h3>
                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">Ù…Ø±ÙƒØ¨Ø§Øª Ù„Ù„Ø¨ÙŠØ¹</p>
                    </div>
                </button>

                <!-- Electronics -->
                <button onclick="filterByCategory('electronics')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-purple-50 hover:to-pink-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="electronics">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-purple-200 group-hover:to-pink-200 dark:group-hover:from-purple-800 dark:group-hover:to-pink-800 transition-colors">
                            <i class="fas fa-microchip text-2xl text-purple-600 dark:text-purple-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ø£Ø¬Ù‡Ø²Ø© ÙˆØªÙ‚Ù†ÙŠØ§Øª</p>
                    </div>
                </button>

                <!-- Fashion -->
                <button onclick="filterByCategory('fashion')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-pink-50 hover:to-rose-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="fashion">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-pink-100 to-rose-100 dark:from-pink-900 dark:to-rose-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-pink-200 group-hover:to-rose-200 dark:group-hover:from-pink-800 dark:group-hover:to-rose-800 transition-colors">
                            <i class="fas fa-tshirt text-2xl text-pink-600 dark:text-pink-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Ø£Ø²ÙŠØ§Ø¡</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ù…Ù„Ø§Ø¨Ø³ ÙˆØ¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</p>
                    </div>
                </button>

                <!-- Home Rental -->
                <button onclick="filterByCategory('home_rental')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-orange-50 hover:to-amber-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="home_rental">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-100 to-amber-100 dark:from-orange-900 dark:to-amber-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-orange-200 group-hover:to-amber-200 dark:group-hover:from-orange-800 dark:group-hover:to-amber-800 transition-colors">
                            <i class="fas fa-home text-2xl text-orange-600 dark:text-orange-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Ø¥ÙŠØ¬Ø§Ø± Ù…Ù†Ø§Ø²Ù„</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ø¹Ù‚Ø§Ø±Ø§Øª Ø³ÙƒÙ†ÙŠØ©</p>
                    </div>
                </button>

                <!-- Jobs -->
                <button onclick="filterByCategory('job')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-indigo-50 hover:to-blue-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="job">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-100 to-blue-100 dark:from-indigo-900 dark:to-blue-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-indigo-200 group-hover:to-blue-200 dark:group-hover:from-indigo-800 dark:group-hover:to-blue-800 transition-colors">
                            <i class="fas fa-briefcase text-2xl text-indigo-600 dark:text-indigo-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">ÙˆØ¸Ø§Ø¦Ù</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">ÙØ±Øµ Ø¹Ù…Ù„</p>
                    </div>
                </button>

                <!-- Furniture -->
                <button onclick="filterByCategory('furniture')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-teal-50 hover:to-cyan-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="furniture">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-teal-100 to-cyan-100 dark:from-teal-900 dark:to-cyan-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-teal-200 group-hover:to-cyan-200 dark:group-hover:from-teal-800 dark:group-hover:to-cyan-800 transition-colors">
                            <i class="fas fa-couch text-2xl text-teal-600 dark:text-teal-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Ø£Ø«Ø§Ø«</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ù…ÙØ±ÙˆØ´Ø§Øª Ù…Ù†Ø²Ù„ÙŠØ©</p>
                    </div>
                </button>

                <!-- Sports -->
                <button onclick="filterByCategory('sports')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-green-50 hover:to-emerald-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="sports">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-green-100 to-emerald-100 dark:from-green-900 dark:to-emerald-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-green-200 group-hover:to-emerald-200 dark:group-hover:from-green-800 dark:group-hover:to-emerald-800 transition-colors">
                            <i class="fas fa-futbol text-2xl text-green-600 dark:text-green-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Ø±ÙŠØ§Ø¶Ø©</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ù…Ø¹Ø¯Ø§Øª Ø±ÙŠØ§Ø¶ÙŠØ©</p>
                    </div>
                </button>

                <!-- Books -->
                <button onclick="filterByCategory('books')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-amber-50 hover:to-yellow-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="books">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-amber-100 to-yellow-100 dark:from-amber-900 dark:to-yellow-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-amber-200 group-hover:to-yellow-200 dark:group-hover:from-amber-800 dark:group-hover:to-yellow-800 transition-colors">
                            <i class="fas fa-book text-2xl text-amber-600 dark:text-amber-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">ÙƒØªØ¨</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ù…Ø·Ø¨ÙˆØ¹Ø§Øª ÙˆÙ…Ø±Ø§Ø¬Ø¹</p>
                    </div>
                </button>

                <!-- Laptop -->
                <button onclick="filterByCategory('laptop')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-gray-50 hover:to-slate-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="laptop">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-slate-100 dark:from-gray-900 dark:to-slate-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-gray-200 group-hover:to-slate-200 dark:group-hover:from-gray-800 dark:group-hover:to-slate-800 transition-colors">
                            <i class="fas fa-laptop text-2xl text-gray-600 dark:text-gray-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Ù„Ø§Ø¨ØªÙˆØ¨</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ…Ø¨ÙŠÙˆØªØ±</p>
                    </div>
                </button>

                <!-- Other -->
                <button onclick="filterByCategory('other')" 
                        class="category-card group bg-white dark:bg-slate-800 hover:bg-gradient-to-br hover:from-slate-50 hover:to-gray-50 dark:hover:from-slate-700 dark:hover:to-slate-600 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 border border-gray-200 dark:border-slate-600" 
                        data-category="other">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-slate-100 to-gray-100 dark:from-slate-900 dark:to-gray-900 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:from-slate-200 group-hover:to-gray-200 dark:group-hover:from-slate-800 dark:group-hover:to-gray-800 transition-colors">
                            <i class="fas fa-ellipsis-h text-2xl text-slate-600 dark:text-slate-400"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Ø£Ø®Ø±Ù‰</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">ÙØ¦Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©</p>
                    </div>
                </button>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section id="products-section" class="py-6 sm:py-8 md:py-10 lg:py-12 bg-gradient-to-br from-gray-50 via-white to-blue-50/30 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900">
        <div class="max-w-7xl mx-auto px-2 sm:px-4 md:px-6 lg:px-8">
            <!-- Section Header -->
            <div class="text-center mb-6 sm:mb-8">
                <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2 sm:mb-3">
                    Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©
                </h2>
                <p class="text-sm sm:text-base md:text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                    Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ù…ÙˆØ«ÙˆÙ‚ÙŠÙ†
                </p>
            </div>
            
            <!-- Search and Filter Controls - Enhanced -->
            <div class="flex flex-col items-center space-y-4 sm:space-y-6 mb-6 sm:mb-8">
                <!-- Search Input - Centered and Responsive -->
                <div class="relative w-full max-w-lg sm:max-w-xl md:max-w-2xl">
                    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø£Ùˆ Ø¨Ø§Ø¦Ø¹..."
                           class="w-full px-4 sm:px-6 py-4 sm:py-5 pl-12 sm:pl-16 pr-4 border-2 border-gray-200 dark:border-slate-600 rounded-2xl sm:rounded-3xl focus:ring-4 focus:ring-emerald-500/20 focus:border-emerald-500 bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 transition-all duration-300 shadow-xl hover:shadow-2xl focus:shadow-2xl text-base sm:text-lg">
                    <div class="absolute left-4 sm:left-6 top-1/2 transform -translate-y-1/2">
                        <i class="fas fa-search text-gray-400 text-lg sm:text-xl"></i>
                    </div>
                    <!-- Search Loading Indicator -->
                    <div id="searchLoading" class="absolute right-4 sm:right-6 top-1/2 transform -translate-y-1/2 hidden">
                        <div class="animate-spin rounded-full h-5 w-5 sm:h-6 sm:w-6 border-b-2 border-emerald-500"></div>
                    </div>
                </div>
                
                <!-- Filter and Add Product Buttons -->
                <div class="flex flex-col sm:flex-row items-center gap-3 sm:gap-4">
                    <!-- Filter Button -->
                    <button onclick="toggleAdvancedFilters()" class="bg-white dark:bg-slate-800 border-2 border-gray-200 dark:border-slate-600 text-gray-700 dark:text-gray-300 px-6 sm:px-8 py-3 sm:py-4 rounded-2xl sm:rounded-3xl hover:bg-gray-50 dark:hover:bg-slate-700 hover:border-emerald-500 hover:text-emerald-600 dark:hover:text-emerald-400 transition-all duration-300 shadow-xl hover:shadow-2xl flex items-center space-x-3 transform hover:scale-105">
                        <i class="fas fa-filter text-lg sm:text-xl"></i>
                        <span class="font-semibold text-base sm:text-lg">ÙÙ„Ø§ØªØ±</span>
                    </button>
                    
                    <!-- Add Product Button -->
                    {% if app.user %}
                    <a href="/products/add" class="bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl sm:rounded-3xl font-semibold transition-all duration-300 shadow-xl hover:shadow-2xl flex items-center space-x-3 transform hover:scale-105">
                        <i class="fas fa-plus text-lg sm:text-xl"></i>
                        <span class="text-base sm:text-lg">Ø£Ø¶Ù Ù…Ù†ØªØ¬</span>
                    </a>
                    {% else %}
                    <a href="/login" class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl sm:rounded-3xl font-semibold transition-all duration-300 shadow-xl hover:shadow-2xl flex items-center space-x-3 transform hover:scale-105">
                        <i class="fas fa-sign-in-alt text-lg sm:text-xl"></i>
                        <span class="text-base sm:text-lg">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Advanced Filters Panel - Enhanced -->
            <div id="advancedFilters" class="bg-white dark:bg-slate-800 rounded-2xl sm:rounded-3xl shadow-2xl border border-gray-200 dark:border-slate-600 p-6 sm:p-8 mb-6 sm:mb-8 hidden">
                <!-- Filter Header -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="h-10 w-10 bg-gradient-to-r from-emerald-500 to-blue-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-filter text-white text-lg"></i>
                        </div>
                        <div>
                            <h3 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø«</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Ù‚Ù… Ø¨ØªØ®ØµÙŠØµ Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ</p>
                        </div>
                    </div>
                    <button onclick="clearAllFilters()" class="text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
                        <i class="fas fa-times-circle ml-1"></i>Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                    </button>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                    <!-- Category Filter -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">
                            <i class="fas fa-th-large ml-2 text-emerald-500"></i>Ø§Ù„ÙØ¦Ø©
                        </label>
                        <select id="categoryFilter" class="w-full px-4 py-3 border border-gray-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-800 text-gray-900 dark:text-white text-sm transition-all duration-200 shadow-sm hover:shadow-md">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                            <option value="car">ğŸš— Ø³ÙŠØ§Ø±Ø§Øª</option>
                            <option value="home_rental">ğŸ  Ø¥ÙŠØ¬Ø§Ø± Ù…Ù†Ø§Ø²Ù„</option>
                            <option value="apartment_rental">ğŸ¢ Ø¥ÙŠØ¬Ø§Ø± Ø´Ù‚Ù‚</option>
                            <option value="job">ğŸ’¼ ÙˆØ¸Ø§Ø¦Ù</option>
                            <option value="laptop">ğŸ’» Ù„Ø§Ø¨ØªÙˆØ¨</option>
                            <option value="electronics">ğŸ“± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                            <option value="fashion">ğŸ‘• Ø£Ø²ÙŠØ§Ø¡</option>
                            <option value="furniture">ğŸª‘ Ø£Ø«Ø§Ø«</option>
                            <option value="books">ğŸ“š ÙƒØªØ¨</option>
                            <option value="sports">âš½ Ø±ÙŠØ§Ø¶Ø©</option>
                            <option value="other">ğŸ“¦ Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    
                    <!-- City Filter -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">
                            <i class="fas fa-map-marker-alt ml-2 text-blue-500"></i>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
                        </label>
                        <select id="cityFilter" class="w-full px-4 py-3 border border-gray-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-slate-800 text-gray-900 dark:text-white text-sm transition-all duration-200 shadow-sm hover:shadow-md">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ù†</option>
                            <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
                            <option value="Ø§Ù„Ø¨ØµØ±Ø©">Ø§Ù„Ø¨ØµØ±Ø©</option>
                            <option value="Ø§Ù„Ù…ÙˆØµÙ„">Ø§Ù„Ù…ÙˆØµÙ„</option>
                            <option value="Ø£Ø±Ø¨ÙŠÙ„">Ø£Ø±Ø¨ÙŠÙ„</option>
                            <option value="ÙƒØ±Ø¨Ù„Ø§Ø¡">ÙƒØ±Ø¨Ù„Ø§Ø¡</option>
                            <option value="Ø§Ù„Ù†Ø¬Ù">Ø§Ù„Ù†Ø¬Ù</option>
                            <option value="ÙƒØ±ÙƒÙˆÙƒ">ÙƒØ±ÙƒÙˆÙƒ</option>
                            <option value="Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ">Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ</option>
                            <option value="Ø§Ù„ÙÙ„ÙˆØ¬Ø©">Ø§Ù„ÙÙ„ÙˆØ¬Ø©</option>
                            <option value="ØªÙƒØ±ÙŠØª">ØªÙƒØ±ÙŠØª</option>
                        </select>
                    </div>
                    
                    <!-- Price Range -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">
                            <i class="fas fa-dollar-sign ml-2 text-green-500"></i>Ù†Ø·Ø§Ù‚ Ø§Ù„Ø³Ø¹Ø±
                        </label>
                        <div class="flex space-x-2">
                            <input type="number" id="minPrice" placeholder="Ù…Ù†" min="0"
                                   class="flex-1 px-3 py-3 border border-gray-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 text-sm transition-all duration-200 shadow-sm hover:shadow-md">
                            <input type="number" id="maxPrice" placeholder="Ø¥Ù„Ù‰" min="0"
                                   class="flex-1 px-3 py-3 border border-gray-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 text-sm transition-all duration-200 shadow-sm hover:shadow-md">
                        </div>
                    </div>
                    
                    <!-- Sort By -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">
                            <i class="fas fa-sort ml-2 text-purple-500"></i>ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨
                        </label>
                        <select id="sortBy" class="w-full px-4 py-3 border border-gray-200 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white dark:bg-slate-800 text-gray-900 dark:text-white text-sm transition-all duration-200 shadow-sm hover:shadow-md">
                            <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
                            <option value="oldest">Ø§Ù„Ø£Ù‚Ø¯Ù…</option>
                            <option value="price_low">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
                            <option value="price_high">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
                            <option value="popular">Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</option>
                        </select>
                    </div>
                </div>
                
                <!-- Filter Actions -->
                <div class="flex flex-col sm:flex-row justify-center sm:justify-end gap-3 sm:gap-4 mt-6 pt-6 border-t border-gray-200 dark:border-slate-600">
                    <button onclick="clearFilters()" class="px-6 py-3 bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-slate-600 transition-all duration-300 flex items-center justify-center space-x-2">
                        <i class="fas fa-times"></i>
                        <span>Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</span>
                    </button>
                    <button onclick="applyFilters()" class="px-6 py-3 bg-gradient-to-r from-emerald-500 to-blue-500 text-white rounded-xl hover:from-emerald-600 hover:to-blue-600 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center space-x-2 transform hover:scale-105">
                        <i class="fas fa-search"></i>
                        <span>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±</span>
                    </button>
                </div>
            </div>
        </div>
    </section>


            <!-- Products Grid - Centered -->
            <div class="flex justify-center">
                <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 sm:gap-6 md:gap-8 max-w-7xl">
                    <!-- Products will be loaded here -->
                </div>
            </div>
            
            <!-- Loading State -->
            <div id="loadingState" class="col-span-full text-center py-8 sm:py-12 hidden">
                <div class="inline-flex items-center space-x-2">
                    <div class="animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-emerald-600"></div>
                    <span class="text-gray-600 dark:text-gray-400 text-sm sm:text-base">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                </div>
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="col-span-full text-center py-8 sm:py-12 hidden">
                <div class="bg-gray-100 dark:bg-slate-700 rounded-full w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 flex items-center justify-center mx-auto mb-4 sm:mb-6">
                    <i class="fas fa-search text-2xl sm:text-3xl md:text-4xl text-gray-400"></i>
                </div>
                <h3 class="text-lg sm:text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h3>
                <p class="text-gray-500 dark:text-gray-500 text-sm sm:text-base">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
            </div>
            
            <!-- Pagination -->
            <div id="pagination" class="col-span-full flex justify-center mt-8 hidden">
                <div class="flex items-center space-x-4">
                    <button id="prevPageBtn" onclick="previousPage()" class="bg-gray-100 dark:bg-slate-700 hover:bg-gray-200 dark:hover:bg-slate-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg font-medium transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-right ml-1"></i>Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                    
                    <div id="pageNumbers" class="flex items-center space-x-2">
                        <!-- Page numbers will be generated here -->
                    </div>
                    
                    <button id="nextPageBtn" onclick="nextPage()" class="bg-gray-100 dark:bg-slate-700 hover:bg-gray-200 dark:hover:bg-slate-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg font-medium transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                        Ø§Ù„ØªØ§Ù„ÙŠ<i class="fas fa-chevron-left mr-1"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>
</div>



<!-- ====== Add Products Modal - DISABLED ====== -->
<!-- Modal removed - now using separate page -->
    <div class="bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 dark:border-slate-700/20 w-full max-w-4xl max-h-[95vh] overflow-y-auto mx-4 hidden">
        <!-- Modal Header -->
        <div class="sticky top-0 bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-gray-200/50 dark:border-slate-700/50 rounded-t-3xl px-8 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="h-12 w-12 bg-gradient-to-r from-emerald-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-plus text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-slate-800 dark:text-white">Ù†Ø´Ø± Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400">Ø§Ù…Ù„Ø£ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ù†Ø´Ø± Ù…Ù†ØªØ¬Ùƒ</p>
                    </div>
                </div>
                <button onclick="closePostProductModal()" class="h-10 w-10 bg-gray-100 dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 rounded-xl flex items-center justify-center transition-all duration-200">
                    <i class="fas fa-times text-gray-600 dark:text-slate-400"></i>
                </button>
            </div>
        </div>
        
        <!-- Modal Body -->
        <div class="p-8">
            <form id="postProductForm" class="space-y-8">
            <!-- Product Title & Price Section -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 border border-blue-100 dark:border-slate-600">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300">
                            <i class="fas fa-tag ml-2 text-blue-500"></i>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ *
                        </label>
                        <input type="text" id="productTitle" required placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬..."
                               class="w-full px-4 py-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 shadow-sm">
                    </div>
                    
                    <div class="space-y-2">
                        <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300">
                            <i class="fas fa-dollar-sign ml-2 text-green-500"></i>Ø§Ù„Ø³Ø¹Ø± *
                        </label>
                        <div class="flex space-x-3">
                            <input type="number" id="productPrice" required min="0" step="0.01" placeholder="0.00"
                                   class="flex-1 px-4 py-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 shadow-sm">
                            <select id="productCurrency" class="px-4 py-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 shadow-sm">
                                <option value="IQD">Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ</option>
                                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                            </select>
                        </div>
                        <div class="flex items-center justify-between">
                            <p class="text-xs text-gray-500 dark:text-slate-400">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</p>
                            <button type="button" onclick="convertCurrency()" class="text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 px-3 py-1 rounded-lg hover:bg-green-200 dark:hover:bg-green-800 transition-colors flex items-center">
                                <i class="fas fa-exchange-alt ml-1"></i>ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø©
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Description Section -->
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 border border-purple-100 dark:border-slate-600">
                <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3">
                    <i class="fas fa-align-right ml-2 text-purple-500"></i>ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ *
                </label>
                <textarea id="productDescription" required rows="4" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ù…ÙØµÙ„Ø§Ù‹ Ø¹Ù† Ù…Ù†ØªØ¬Ùƒ..."
                          class="w-full px-4 py-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 shadow-sm resize-none"></textarea>
            </div>

            <!-- Category & Location Section -->
            <div class="bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 border border-emerald-100 dark:border-slate-600">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300">
                            <i class="fas fa-th-large ml-2 text-emerald-500"></i>Ø§Ù„ÙØ¦Ø© *
                        </label>
                        <select id="productCategory" required
                                class="w-full px-4 py-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 shadow-sm">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                            <option value="car">ğŸš— Ø³ÙŠØ§Ø±Ø§Øª</option>
                            <option value="home_rental">ğŸ  Ø¥ÙŠØ¬Ø§Ø± Ù…Ù†Ø§Ø²Ù„</option>
                            <option value="apartment_rental">ğŸ¢ Ø¥ÙŠØ¬Ø§Ø± Ø´Ù‚Ù‚</option>
                            <option value="job">ğŸ’¼ ÙˆØ¸Ø§Ø¦Ù</option>
                            <option value="laptop">ğŸ’» Ù„Ø§Ø¨ØªÙˆØ¨</option>
                            <option value="electronics">ğŸ“± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                            <option value="fashion">ğŸ‘• Ø£Ø²ÙŠØ§Ø¡</option>
                            <option value="furniture">ğŸª‘ Ø£Ø«Ø§Ø«</option>
                            <option value="books">ğŸ“š ÙƒØªØ¨</option>
                            <option value="sports">âš½ Ø±ÙŠØ§Ø¶Ø©</option>
                            <option value="other">ğŸ“¦ Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                
                    <div class="space-y-2">
                        <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300">
                            <i class="fas fa-map-marker-alt ml-2 text-teal-500"></i>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *
                        </label>
                        <select id="productCity" required
                                class="w-full px-4 py-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200 shadow-sm">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                        <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
                        <option value="Ø§Ù„Ø¨ØµØ±Ø©">Ø§Ù„Ø¨ØµØ±Ø©</option>
                        <option value="Ø§Ù„Ù…ÙˆØµÙ„">Ø§Ù„Ù…ÙˆØµÙ„</option>
                        <option value="Ø£Ø±Ø¨ÙŠÙ„">Ø£Ø±Ø¨ÙŠÙ„</option>
                        <option value="Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©">Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option>
                        <option value="Ø¯Ù‡ÙˆÙƒ">Ø¯Ù‡ÙˆÙƒ</option>
                        <option value="ÙƒØ±ÙƒÙˆÙƒ">ÙƒØ±ÙƒÙˆÙƒ</option>
                        <option value="Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ">Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ</option>
                        <option value="Ø§Ù„ÙÙ„ÙˆØ¬Ø©">Ø§Ù„ÙÙ„ÙˆØ¬Ø©</option>
                        <option value="ØªÙƒØ±ÙŠØª">ØªÙƒØ±ÙŠØª</option>
                        <option value="Ø¨Ø¹Ù‚ÙˆØ¨Ø©">Ø¨Ø¹Ù‚ÙˆØ¨Ø©</option>
                        <option value="ÙƒØ±Ø¨Ù„Ø§Ø¡">ÙƒØ±Ø¨Ù„Ø§Ø¡</option>
                        <option value="Ø§Ù„Ù†Ø¬Ù">Ø§Ù„Ù†Ø¬Ù</option>
                        <option value="Ø§Ù„Ø­Ù„Ø©">Ø§Ù„Ø­Ù„Ø©</option>
                        <option value="Ø§Ù„ÙƒÙˆØª">Ø§Ù„ÙƒÙˆØª</option>
                        <option value="Ø§Ù„Ø¯ÙŠÙˆØ§Ù†ÙŠØ©">Ø§Ù„Ø¯ÙŠÙˆØ§Ù†ÙŠØ©</option>
                        <option value="Ø§Ù„Ø³Ù…Ø§ÙˆØ©">Ø§Ù„Ø³Ù…Ø§ÙˆØ©</option>
                        <option value="Ø§Ù„Ù†Ø§ØµØ±ÙŠØ©">Ø§Ù„Ù†Ø§ØµØ±ÙŠØ©</option>
                        <option value="Ø§Ù„Ø¹Ù…Ø§Ø±Ø©">Ø§Ù„Ø¹Ù…Ø§Ø±Ø©</option>
                        <option value="Ø§Ù„Ø£Ù†Ø¨Ø§Ø±">Ø§Ù„Ø£Ù†Ø¨Ø§Ø±</option>
                        <option value="Ø¯ÙŠØ§Ù„Ù‰">Ø¯ÙŠØ§Ù„Ù‰</option>
                        <option value="ÙˆØ§Ø³Ø·">ÙˆØ§Ø³Ø·</option>
                        <option value="Ù…ÙŠØ³Ø§Ù†">Ù…ÙŠØ³Ø§Ù†</option>
                        <option value="Ø°ÙŠ Ù‚Ø§Ø±">Ø°ÙŠ Ù‚Ø§Ø±</option>
                        <option value="Ø§Ù„Ù…Ø«Ù†Ù‰">Ø§Ù„Ù…Ø«Ù†Ù‰</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Location & Details Section -->
            <div class="bg-gradient-to-r from-orange-50 to-red-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 border border-orange-100 dark:border-slate-600">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300">
                            <i class="fas fa-map-pin ml-2 text-orange-500"></i>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ *
                        </label>
                        <div class="relative">
                            <input type="text" id="productLocation" required placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§Ø±Ø¹ Ø§Ù„Ø±Ø´ÙŠØ¯ØŒ Ø­ÙŠ Ø§Ù„ÙƒØ±Ø§Ø¯Ø©ØŒ Ø¨ØºØ¯Ø§Ø¯"
                                   class="w-full px-4 py-4 pr-12 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200 shadow-sm">
                            <button type="button" onclick="getCurrentLocation()" 
                                    class="absolute left-3 top-1/2 transform -translate-y-1/2 text-orange-500 hover:text-orange-700 dark:text-orange-400 dark:hover:text-orange-300 transition-colors"
                                    title="Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ">
                                <i class="fas fa-map-marker-alt text-lg"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between">
                            <p class="text-xs text-gray-500 dark:text-slate-400">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„ÙŠØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„</p>
                            <button type="button" onclick="getCurrentLocation()" 
                                    class="text-xs bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 px-3 py-1 rounded-lg hover:bg-orange-200 dark:hover:bg-orange-800 transition-colors flex items-center">
                                <i class="fas fa-crosshairs ml-1"></i>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
                            </button>
                        </div>
                    </div>
                
                    <div class="space-y-2">
                        <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300">
                            <i class="fas fa-palette ml-2 text-red-500"></i>Ø§Ù„Ù„ÙˆÙ†
                        </label>
                        <select id="productColor" class="w-full px-4 py-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 shadow-sm">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†</option>
                            <option value="Ø£Ø¨ÙŠØ¶">âšª Ø£Ø¨ÙŠØ¶</option>
                            <option value="Ø£Ø³ÙˆØ¯">âš« Ø£Ø³ÙˆØ¯</option>
                            <option value="Ø£Ø­Ù…Ø±">ğŸ”´ Ø£Ø­Ù…Ø±</option>
                            <option value="Ø£Ø²Ø±Ù‚">ğŸ”µ Ø£Ø²Ø±Ù‚</option>
                            <option value="Ø£Ø®Ø¶Ø±">ğŸŸ¢ Ø£Ø®Ø¶Ø±</option>
                            <option value="Ø£ØµÙØ±">ğŸŸ¡ Ø£ØµÙØ±</option>
                            <option value="Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ">ğŸŸ  Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</option>
                            <option value="Ø¨Ù†ÙØ³Ø¬ÙŠ">ğŸŸ£ Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                            <option value="ÙˆØ±Ø¯ÙŠ">ğŸ©· ÙˆØ±Ø¯ÙŠ</option>
                            <option value="Ø¨Ù†ÙŠ">ğŸŸ¤ Ø¨Ù†ÙŠ</option>
                            <option value="Ø±Ù…Ø§Ø¯ÙŠ">ğŸ”˜ Ø±Ù…Ø§Ø¯ÙŠ</option>
                            <option value="ÙØ¶ÙŠ">âšª ÙØ¶ÙŠ</option>
                            <option value="Ø°Ù‡Ø¨ÙŠ">ğŸŸ¡ Ø°Ù‡Ø¨ÙŠ</option>
                            <option value="Ù†Ø­Ø§Ø³ÙŠ">ğŸŸ¤ Ù†Ø­Ø§Ø³ÙŠ</option>
                            <option value="Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù†">ğŸŒˆ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</option>
                            <option value="Ø£Ø®Ø±Ù‰">â“ Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Condition & Images Section -->
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 border border-indigo-100 dark:border-slate-600">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300">
                            <i class="fas fa-star ml-2 text-indigo-500"></i>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬
                        </label>
                        <select id="productCondition" class="w-full px-4 py-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 rounded-xl text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 shadow-sm">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
                            <option value="Ø¬Ø¯ÙŠØ¯">âœ¨ Ø¬Ø¯ÙŠØ¯</option>
                            <option value="Ù…Ø³ØªØ¹Ù…Ù„ - Ù…Ù…ØªØ§Ø²">â­ Ù…Ø³ØªØ¹Ù…Ù„ - Ù…Ù…ØªØ§Ø²</option>
                            <option value="Ù…Ø³ØªØ¹Ù…Ù„ - Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹">ğŸ‘ Ù…Ø³ØªØ¹Ù…Ù„ - Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
                            <option value="Ù…Ø³ØªØ¹Ù…Ù„ - Ø¬ÙŠØ¯">ğŸ‘ Ù…Ø³ØªØ¹Ù…Ù„ - Ø¬ÙŠØ¯</option>
                            <option value="Ù…Ø³ØªØ¹Ù…Ù„ - Ù…Ù‚Ø¨ÙˆÙ„">ğŸ‘Œ Ù…Ø³ØªØ¹Ù…Ù„ - Ù…Ù‚Ø¨ÙˆÙ„</option>
                            <option value="ÙŠØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­">ğŸ”§ ÙŠØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­</option>
                            <option value="Ù„Ù„Ù‚Ø·Ø¹">ğŸ”¨ Ù„Ù„Ù‚Ø·Ø¹</option>
                            <option value="Ù…Ø´Ø±ÙˆØ¹">ğŸš§ Ù…Ø´Ø±ÙˆØ¹</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300">
                            <i class="fas fa-images ml-2 text-purple-500"></i>ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="aspect-square bg-white dark:bg-slate-800 rounded-xl border-2 border-dashed border-purple-300 dark:border-purple-600 flex items-center justify-center cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group" onclick="selectImage(1)">
                                <input type="file" id="image1" accept="image/*" style="display: none;" onchange="handleImagePreview(1)">
                                <div id="image1Preview" class="text-center">
                                    <i class="fas fa-camera text-2xl text-purple-400 group-hover:text-purple-600 dark:group-hover:text-purple-300 mb-2 transition-colors"></i>
                                    <p class="text-sm text-purple-600 dark:text-purple-400 font-medium">ØµÙˆØ±Ø© 1</p>
                                </div>
                            </div>
                            <div class="aspect-square bg-white dark:bg-slate-800 rounded-xl border-2 border-dashed border-purple-300 dark:border-purple-600 flex items-center justify-center cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group" onclick="selectImage(2)">
                                <input type="file" id="image2" accept="image/*" style="display: none;" onchange="handleImagePreview(2)">
                                <div id="image2Preview" class="text-center">
                                    <i class="fas fa-camera text-2xl text-purple-400 group-hover:text-purple-600 dark:group-hover:text-purple-300 mb-2 transition-colors"></i>
                                    <p class="text-sm text-purple-600 dark:text-purple-400 font-medium">ØµÙˆØ±Ø© 2</p>
                                </div>
                            </div>
                            <div class="aspect-square bg-white dark:bg-slate-800 rounded-xl border-2 border-dashed border-purple-300 dark:border-purple-600 flex items-center justify-center cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group" onclick="selectImage(3)">
                                <input type="file" id="image3" accept="image/*" style="display: none;" onchange="handleImagePreview(3)">
                                <div id="image3Preview" class="text-center">
                                    <i class="fas fa-camera text-2xl text-purple-400 group-hover:text-purple-600 dark:group-hover:text-purple-300 mb-2 transition-colors"></i>
                                    <p class="text-sm text-purple-600 dark:text-purple-400 font-medium">ØµÙˆØ±Ø© 3</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Section -->
            <div class="bg-gradient-to-r from-emerald-50 to-green-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl p-6 border border-emerald-100 dark:border-slate-600">
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button type="submit" id="submitProductBtn" class="flex-1 bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center">
                        <i class="fas fa-plus ml-2 text-lg"></i>Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬
                    </button>
                    <button type="button" onclick="closePostProductModal()" class="px-8 py-4 bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 text-gray-700 dark:text-slate-300 rounded-xl font-semibold transition-all duration-300 border border-gray-200 dark:border-slate-600 flex items-center justify-center">
                        <i class="fas fa-times ml-2"></i>Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>
        </form>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
    <div class="max-w-4xl max-h-[90vh] p-4">
        <img id="modalImage" src="" alt="" class="max-w-full max-h-full object-contain rounded-lg">
        <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white text-2xl hover:text-gray-300">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<script>
let currentPage = 1;
let totalPages = 1;
let totalProducts = 0;
let isLoading = false;

// User Dropdown Toggle
function toggleUserDropdown() {
    const dropdown = document.getElementById('userDropdownMenu');
    const arrow = document.getElementById('dropdownArrow');
    
    if (dropdown.classList.contains('opacity-0')) {
        // Show dropdown
        dropdown.classList.remove('opacity-0', 'invisible', 'scale-95');
        dropdown.classList.add('opacity-100', 'visible', 'scale-100');
        arrow.classList.add('rotate-180');
    } else {
        // Hide dropdown
        dropdown.classList.add('opacity-0', 'invisible', 'scale-95');
        dropdown.classList.remove('opacity-100', 'visible', 'scale-100');
        arrow.classList.remove('rotate-180');
    }
}

// Language Switcher Toggle
function toggleLanguageSwitcher() {
    const dropdown = document.getElementById('languageDropdown');
    
    if (dropdown.classList.contains('hidden')) {
        dropdown.classList.remove('hidden');
    } else {
        dropdown.classList.add('hidden');
    }
}

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('userDropdown');
    const dropdownMenu = document.getElementById('userDropdownMenu');
    const languageDropdown = document.getElementById('languageDropdown');
    
    if (dropdown && !dropdown.contains(event.target)) {
        dropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
        dropdownMenu.classList.remove('opacity-100', 'visible', 'scale-100');
        document.getElementById('dropdownArrow').classList.remove('rotate-180');
    }
    
    // Close language dropdown when clicking outside
    if (languageDropdown && !languageDropdown.parentElement.contains(event.target)) {
        languageDropdown.classList.add('hidden');
    }
});

// Logout function
async function logout() {
    try {
        showLoading();
        const response = await apiCall('/api/logout', { method: 'POST' });
        
        if (response.success) {
            localStorage.removeItem('jwt_token');
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setTimeout(() => {
                window.location.href = '/login';
            }, 1000);
        } else {
            showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
        }
    } catch (error) {
        console.error('Logout error:', error);
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ' + error.message, 'error');
    } finally {
        hideLoading();
    }
}

// Modal functions removed - now using separate page

// All modal-related functions removed - now using separate page

// Image Modal Functions
function openImageModal(imageSrc) {
    document.getElementById('modalImage').src = imageSrc;
    document.getElementById('imageModal').classList.remove('hidden');
}

function closeImageModal() {
    document.getElementById('imageModal').classList.add('hidden');
}

// All modal-related code removed - now using separate page

// Search Loading Functions
function showSearchLoading() {
    const searchLoading = document.getElementById('searchLoading');
    if (searchLoading) {
        searchLoading.classList.remove('hidden');
    }
}

function hideSearchLoading() {
    const searchLoading = document.getElementById('searchLoading');
    if (searchLoading) {
        searchLoading.classList.add('hidden');
    }
}

// Filter Functions
function applyFilters() {
    console.log('Applying filters...');
    currentPage = 1;
    loadProducts();
}

function clearAllFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('categoryFilter').value = '';
    document.getElementById('cityFilter').value = '';
    document.getElementById('minPrice').value = '';
    document.getElementById('maxPrice').value = '';
    document.getElementById('sortBy').value = 'newest';
    
    // Clear seller results
    const existingSellerResults = document.getElementById('sellerResults');
    if (existingSellerResults) {
        existingSellerResults.remove();
    }
    
    // Hide advanced filters
    document.getElementById('advancedFilters').classList.add('hidden');
    
    // Reset to first page and load products
    currentPage = 1;
    loadProducts();
}

function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('categoryFilter').value = '';
    document.getElementById('cityFilter').value = '';
    document.getElementById('minPrice').value = '';
    document.getElementById('maxPrice').value = '';
    
    // Clear seller results
    const existingSellerResults = document.getElementById('sellerResults');
    if (existingSellerResults) {
        existingSellerResults.remove();
    }
    
    applyFilters();
}

// Load Products
async function loadProducts() {
    if (isLoading) return;
    
    isLoading = true;
    
    const params = new URLSearchParams({
        page: currentPage,
        limit: 12
    });

    const search = document.getElementById('searchInput')?.value || '';
    const category = document.getElementById('categoryFilter')?.value || '';
    const city = document.getElementById('cityFilter')?.value || '';
    const minPrice = document.getElementById('minPrice')?.value || '';
    const maxPrice = document.getElementById('maxPrice')?.value || '';

    console.log('Filter values:', { search, category, city, minPrice, maxPrice, selectedCategory });

    if (search) params.append('search', search);
    
    // Use selected category from slider if not 'all', otherwise use sidebar filter
    if (selectedCategory !== 'all') {
        params.append('category', selectedCategory);
    } else if (category) {
        params.append('category', category);
    }
    
    if (city) params.append('city', city);
    if (minPrice) params.append('min_price', minPrice);
    if (maxPrice) params.append('max_price', maxPrice);

    console.log('API URL:', `/api/products?${params.toString()}`);

    try {
        // Show loading indicator
        document.getElementById('loadingState').classList.remove('hidden');
        document.getElementById('emptyState').classList.add('hidden');
        document.getElementById('pagination').classList.add('hidden');
        
        const response = await apiCall(`/web/products?${params.toString()}`);
        
        // Handle web endpoint response format
        let products = [];
        let total = 0;
        
        if (response.products && Array.isArray(response.products)) {
            // Web endpoint format
            products = response.products;
            total = response.pagination?.total || response.products.length;
        } else if (Array.isArray(response)) {
            // Direct array response
            products = response;
            total = response.length;
        } else if (response.member && Array.isArray(response.member)) {
            // JSON-LD format with member array
            products = response.member;
            total = response.totalItems || response.member.length;
        } else {
            // Fallback
            products = [];
            total = 0;
        }
        
        // Update pagination info
        totalProducts = total;
        totalPages = Math.ceil(totalProducts / 12);
        
        // Show loading state
        document.getElementById('loadingState').classList.add('hidden');
        hideSearchLoading();
        
        window.currentProducts = products;
        renderProducts(products);
        
        // Show results count for filtered results
        const hasFilters = search || category || city || minPrice || maxPrice || selectedCategory !== 'all';
        if (hasFilters && currentPage === 1) {
            showToast(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${totalProducts} Ù…Ù†ØªØ¬`, 'success');
        }
        
    } catch (error) {
        console.error('Error loading products:', error);
        document.getElementById('loadingState').classList.add('hidden');
        hideSearchLoading();
        document.getElementById('productsGrid').innerHTML = `
            <div class="col-span-full text-center py-12">
                <div class="bg-red-100 dark:bg-red-900/20 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-exclamation-triangle text-4xl text-red-500"></i>
                </div>
                <h3 class="text-xl font-semibold text-red-600 dark:text-red-400 mb-2">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
                <button onclick="loadProducts()" class="bg-gradient-to-r from-emerald-500 to-blue-500 text-white px-6 py-3 rounded-xl hover:from-emerald-600 hover:to-blue-600 transition-all duration-300 shadow-lg">
                    <i class="fas fa-refresh ml-2"></i>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                </button>
            </div>
        `;
        showToast('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ' + error.message, 'error');
    } finally {
        isLoading = false;
    }
}

function nextPage() {
    if (currentPage < totalPages) {
        currentPage++;
        loadProducts();
    }
}

function previousPage() {
    if (currentPage > 1) {
        currentPage--;
        loadProducts();
    }
}

function goToPage(page) {
    if (page >= 1 && page <= totalPages) {
        currentPage = page;
        loadProducts();
    }
}

function updatePagination() {
    const paginationContainer = document.getElementById('pagination');
    const pageNumbersContainer = document.getElementById('pageNumbers');
    const prevBtn = document.getElementById('prevPageBtn');
    const nextBtn = document.getElementById('nextPageBtn');
    
    if (totalPages <= 1) {
        paginationContainer.classList.add('hidden');
        return;
    }
    
    paginationContainer.classList.remove('hidden');
    
    // Update prev/next buttons
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
    
    // Generate page numbers
    let pageNumbers = '';
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    // Adjust start page if we're near the end
    if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    // Add first page and ellipsis if needed
    if (startPage > 1) {
        pageNumbers += `
            <button onclick="goToPage(1)" class="px-3 py-2 rounded-lg font-medium transition-all duration-300 bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700">
                1
            </button>
        `;
        if (startPage > 2) {
            pageNumbers += `<span class="px-2 text-gray-500">...</span>`;
        }
    }
    
    // Add visible page numbers
    for (let i = startPage; i <= endPage; i++) {
        const isActive = i === currentPage;
        pageNumbers += `
            <button onclick="goToPage(${i})" class="px-3 py-2 rounded-lg font-medium transition-all duration-300 ${
                isActive 
                    ? 'bg-emerald-500 text-white' 
                    : 'bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700'
            }">
                ${i}
            </button>
        `;
    }
    
    // Add last page and ellipsis if needed
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            pageNumbers += `<span class="px-2 text-gray-500">...</span>`;
        }
        pageNumbers += `
            <button onclick="goToPage(${totalPages})" class="px-3 py-2 rounded-lg font-medium transition-all duration-300 bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700">
                ${totalPages}
            </button>
        `;
    }
    
    pageNumbersContainer.innerHTML = pageNumbers;
}

function renderProducts(products) {
    const container = document.getElementById('productsGrid');
    
    // Clear existing products
    container.innerHTML = '';
    
    if (products.length === 0) {
        document.getElementById('emptyState').classList.remove('hidden');
        document.getElementById('loadingState').classList.add('hidden');
        return;
    }
    
    document.getElementById('emptyState').classList.add('hidden');
    
    products.forEach(product => {
        const productElement = createProductElement(product);
        container.appendChild(productElement);
    });
    
    // Update pagination
    updatePagination();
}

function createProductElement(product) {
    const div = document.createElement('div');
    div.className = 'product-card bg-white dark:bg-slate-800 rounded-2xl shadow-lg hover:shadow-2xl border border-gray-100 dark:border-slate-700 overflow-hidden transition-all duration-500 cursor-pointer hover:scale-[1.02] hover:-translate-y-3 group relative';
    div.onclick = function(e) {
        // Don't trigger if clicking on buttons
        if (e.target.closest('button')) return;
        // Open product details
        viewProduct(product.id);
    };
    
    // Get product images
    const images = [];
    if (product.hasImages && product.hasImages.image1) images.push(`/api/products/image/${product.id}/1`);
    if (product.hasImages && product.hasImages.image2) images.push(`/api/products/image/${product.id}/2`);
    if (product.hasImages && product.hasImages.image3) images.push(`/api/products/image/${product.id}/3`);
    
    // Create main image (first image or placeholder)
    const mainImage = images.length > 0 ? images[0] : '/placeholder-image.jpg';
    
    // Create image gallery indicators
    const imageGallery = images.length > 1 ? `
        <div class="absolute bottom-3 left-3 flex space-x-1.5">
            ${images.slice(0, 3).map((_, index) => `
                <div class="w-2 h-2 bg-white/80 rounded-full shadow-sm ${index === 0 ? 'bg-white' : 'bg-white/50'}"></div>
            `).join('')}
            ${images.length > 3 ? `<div class="w-2 h-2 bg-white/80 rounded-full shadow-sm text-xs flex items-center justify-center text-white font-bold">+</div>` : ''}
        </div>
    ` : '';
    
    // Get category icon and color
    const categoryData = {
        'car': { icon: 'fas fa-car', color: 'from-blue-500 to-blue-600', bg: 'bg-blue-50 dark:bg-blue-900/20', text: 'text-blue-600 dark:text-blue-400' },
        'electronics': { icon: 'fas fa-microchip', color: 'from-purple-500 to-purple-600', bg: 'bg-purple-50 dark:bg-purple-900/20', text: 'text-purple-600 dark:text-purple-400' },
        'fashion': { icon: 'fas fa-tshirt', color: 'from-pink-500 to-pink-600', bg: 'bg-pink-50 dark:bg-pink-900/20', text: 'text-pink-600 dark:text-pink-400' },
        'furniture': { icon: 'fas fa-couch', color: 'from-orange-500 to-orange-600', bg: 'bg-orange-50 dark:bg-orange-900/20', text: 'text-orange-600 dark:text-orange-400' },
        'sports': { icon: 'fas fa-futbol', color: 'from-green-500 to-green-600', bg: 'bg-green-50 dark:bg-green-900/20', text: 'text-green-600 dark:text-green-400' },
        'books': { icon: 'fas fa-book', color: 'from-indigo-500 to-indigo-600', bg: 'bg-indigo-50 dark:bg-indigo-900/20', text: 'text-indigo-600 dark:text-indigo-400' },
        'laptop': { icon: 'fas fa-laptop', color: 'from-gray-500 to-gray-600', bg: 'bg-gray-50 dark:bg-gray-900/20', text: 'text-gray-600 dark:text-gray-400' },
        'home_rental': { icon: 'fas fa-home', color: 'from-emerald-500 to-emerald-600', bg: 'bg-emerald-50 dark:bg-emerald-900/20', text: 'text-emerald-600 dark:text-emerald-400' },
        'apartment_rental': { icon: 'fas fa-building', color: 'from-teal-500 to-teal-600', bg: 'bg-teal-50 dark:bg-teal-900/20', text: 'text-teal-600 dark:text-teal-400' },
        'job': { icon: 'fas fa-briefcase', color: 'from-amber-500 to-amber-600', bg: 'bg-amber-50 dark:bg-amber-900/20', text: 'text-amber-600 dark:text-amber-400' },
        'other': { icon: 'fas fa-box', color: 'from-slate-500 to-slate-600', bg: 'bg-slate-50 dark:bg-slate-900/20', text: 'text-slate-600 dark:text-slate-400' }
    };
    
    const category = categoryData[product.category] || categoryData['other'];
    
    div.innerHTML = `
        <!-- Product Image Container -->
        <div class="relative h-64 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-slate-700 dark:to-slate-600 overflow-hidden">
            <img src="${mainImage}" 
                 alt="${product.title}" 
                 class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-out"
                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMjUgNzVIMTc1VjEyNUgxMjVWNzVaIiBmaWxsPSIjOUNBM0FGIi8+CjxwYXRoIGQ9Ik0xMzUgODVIMTY1VjExNUgxMzVWODVaIiBmaWxsPSIjNjM2NkY3Ii8+CjxjaXJjbGUgY3g9IjE1MCIgY3k9IjEwMCIgcj0iNSIgZmlsbD0iIzZCNzI4MCIvPgo8dGV4dCB4PSIxNTAiIHk9IjE1MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzlDQTNBRiIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0Ij5ObyBJbWFnZTwvdGV4dD4KPC9zdmc+'">
            
            <!-- Gradient Overlay -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/30 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            
            <!-- Category Badge -->
            <div class="absolute top-4 left-4">
                <span class="${category.bg} ${category.text} px-3 py-1.5 rounded-full text-xs font-semibold flex items-center space-x-1.5 shadow-lg backdrop-blur-sm border border-white/20">
                    <i class="${category.icon} text-xs"></i>
                    <span>${product.categoryDisplay || product.category}</span>
                </span>
            </div>
            
            <!-- Price Badge -->
            <div class="absolute top-4 right-4">
                <span class="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-xl backdrop-blur-sm border border-white/20">
                    ${product.price} ${product.currencyDisplay || 'IQD'}
                </span>
            </div>
            
            <!-- Quick View Button -->
            <div class="absolute bottom-4 right-4 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-3 group-hover:translate-y-0">
                <button onclick="event.stopPropagation(); viewProduct(${product.id})" class="bg-white/95 dark:bg-slate-800/95 backdrop-blur-md text-gray-700 dark:text-gray-300 p-3 rounded-full shadow-xl hover:bg-white dark:hover:bg-slate-800 transition-all duration-200 hover:scale-110">
                    <i class="fas fa-eye text-lg"></i>
                </button>
            </div>
            
            <!-- Image Gallery Indicators -->
            ${imageGallery}
            
            <!-- Click to View Overlay -->
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-all duration-300 flex items-center justify-center">
                <div class="opacity-0 group-hover:opacity-100 transition-all duration-300 transform scale-95 group-hover:scale-100">
                    <div class="bg-white/95 dark:bg-slate-800/95 backdrop-blur-md text-gray-700 dark:text-gray-300 px-4 py-2 rounded-full text-sm font-semibold shadow-xl border border-white/20">
                        <i class="fas fa-eye ml-2"></i>
                        Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Product Content -->
        <div class="p-6">
            <!-- Product Title -->
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors duration-300 leading-tight">
                ${product.title}
            </h3>
            
            <!-- Product Description -->
            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-2 leading-relaxed">
                ${product.description}
            </p>
            
            <!-- Seller Info -->
            <div class="flex items-center space-x-3 mb-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700 p-3 rounded-xl transition-all duration-300 group/seller" onclick="event.stopPropagation(); viewProfile(${product.seller.id})" title="Ø¹Ø±Ø¶ Ù…Ù„Ù Ø§Ù„Ø¨Ø§Ø¦Ø¹">
                <div class="h-10 w-10 bg-gradient-to-br from-emerald-400 to-blue-500 rounded-full flex items-center justify-center overflow-hidden shadow-md ring-2 ring-white dark:ring-slate-800">
                    <img src="/api/user/avatar/${product.seller.id}" 
                         alt="${product.seller.name}" 
                         class="w-full h-full object-cover"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <i class="fas fa-user text-white text-sm" style="display: none;"></i>
                </div>
                <div class="flex-1">
                    <p class="text-sm font-semibold text-gray-900 dark:text-white group-hover/seller:text-blue-600 dark:group-hover/seller:text-blue-400 transition-colors">${product.seller.name}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-500">${product.city}</p>
                </div>
                <span class="text-xs text-gray-500 dark:text-gray-500 bg-gray-100 dark:bg-slate-700 px-2 py-1 rounded-full">${formatDate(product.createdAt)}</span>
            </div>
            
            <!-- Product Details -->
            <div class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 mb-4">
                <div class="flex items-center space-x-4">
                    <span class="flex items-center space-x-1">
                        <i class="fas fa-map-marker-alt text-xs text-gray-400"></i>
                        <span>${product.city}</span>
                    </span>
                    ${product.condition ? `
                    <span class="flex items-center space-x-1">
                        <i class="fas fa-star text-xs text-yellow-500"></i>
                        <span>${product.condition}</span>
                    </span>
                    ` : ''}
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex space-x-2 mt-4">
                ${getProductButtons(product)}
            </div>
            
            <!-- Quick Actions for Visitors -->
            <div class="mt-4 pt-4 border-t border-gray-100 dark:border-slate-600">
                <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                    <button onclick="viewProduct(${product.id})" class="flex items-center space-x-1 bg-gray-50 dark:bg-slate-700 px-3 py-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors cursor-pointer hover:scale-105">
                        <i class="fas fa-eye"></i>
                        <span>Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</span>
                    </button>
                    <button onclick="viewProfile(${product.seller.id})" class="flex items-center space-x-1 bg-gray-50 dark:bg-slate-700 px-3 py-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors cursor-pointer hover:scale-105">
                        <i class="fas fa-user"></i>
                        <span>Ù…Ù„Ù Ø§Ù„Ø¨Ø§Ø¦Ø¹</span>
                    </button>
                </div>
            </div>
        </div>
    `;
    
    return div;
}

function contactSeller(sellerId) {
    window.location.href = `/messages?seller=${sellerId}`;
}

// Contact seller with product details
function contactSellerWithProduct(productId, sellerId) {
    if (!sellerId || sellerId === 0) {
        showToast('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'warning');
        return;
    }
    
    // Find the product details from current products
    const product = window.currentProducts?.find(p => p.id === productId);
    if (!product) {
        showToast('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'warning');
        return;
    }
    
    // Create product attachment data
    const productAttachment = {
        productId: product.id,
        productName: product.title,
        productPrice: `${product.price} ${product.currencyDisplay || product.currency}`,
        productImage: product.hasImages?.image1 ? `/api/products/image/${product.id}/1` : null,
        productCategory: product.categoryDisplay || product.category,
        productCity: product.city,
        sellerName: product.seller.name,
        productDescription: product.description
    };
    
    // Encode the product data as URL parameter
    const productData = encodeURIComponent(JSON.stringify(productAttachment));
    
    // Redirect to messages with product attachment
    window.location.href = `/messages?seller=${sellerId}&product=${productData}`;
}

// View seller profile function
function viewSellerProfile(sellerId) {
    if (!sellerId || sellerId === 0) {
        showToast('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'warning');
        return;
    }
    
    // Open seller profile in a new tab
    window.open(`/profile/${sellerId}`, '_blank');
}

// View product details function
function viewProduct(productId) {
    if (!productId || productId === 0) {
        showToast('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'warning');
        return;
    }
    
    // Open product details page in a new tab
    window.open(`/products/${productId}`, '_blank');
}

// View seller profile function (unified)
function viewProfile(userId) {
    if (!userId || userId === 0) {
        showToast('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'warning');
        return;
    }
    
    // Open profile in a new tab
    window.open(`/profile/${userId}`, '_blank');
}

// Get status badge class
function getStatusBadgeClass(status) {
    switch (status) {
        case 'available': return 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200';
        case 'sold': return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
        case 'reserved': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
        default: return 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200';
    }
}

// Get status text
function getStatusText(status) {
    switch (status) {
        case 'available': return 'Ù…ØªØ§Ø­';
        case 'sold': return 'Ù…Ø¨Ø§Ø¹';
        case 'reserved': return 'Ù…Ø­Ø¬ÙˆØ²';
        default: return 'Ù…ØªØ§Ø­';
    }
}

function getProductButtons(product) {
    const currentUserId = getCurrentUserId();
    
    if (currentUserId && currentUserId == product.seller.id) {
        // Show edit and delete buttons for product owner
        return `
            <button onclick="editProduct(${product.id})" class="flex-1 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300 text-sm shadow-lg hover:shadow-xl transform hover:scale-105">
                <i class="fas fa-edit ml-2"></i>ØªØ¹Ø¯ÙŠÙ„
            </button>
            <button onclick="deleteProduct(${product.id})" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300 text-sm shadow-lg hover:shadow-xl transform hover:scale-105">
                <i class="fas fa-trash"></i>
            </button>
        `;
    } else {
        // Enhanced buttons for visitors - more interactive and user-friendly
        return `
            <button onclick="contactSellerWithProduct(${product.id}, ${product.seller.id})" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300 text-sm shadow-lg hover:shadow-xl transform hover:scale-105">
                <i class="fas fa-comments ml-2"></i>Ø±Ø³Ø§Ù„Ø©
            </button>
            <button onclick="viewProfile(${product.seller.id})" class="px-4 py-3 border-2 border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-slate-600 transition-all duration-300 text-sm hover:shadow-md transform hover:scale-105" title="Ø¹Ø±Ø¶ Ù…Ù„Ù Ø§Ù„Ø¨Ø§Ø¦Ø¹">
                <i class="fas fa-user"></i>
            </button>
            <button onclick="viewProduct(${product.id})" class="px-4 py-3 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white rounded-xl transition-all duration-300 text-sm shadow-lg hover:shadow-xl transform hover:scale-105" title="Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬">
                <i class="fas fa-eye"></i>
            </button>
        `;
    }
}

function getCurrentUserId() {
    // This should be set from the backend when the page loads
    return window.currentUserId || null;
}

function editProduct(productId) {
    // Open product edit page
    window.open(`/products/${productId}/edit`, '_blank');
}

async function deleteProduct(productId) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
        try {
            showLoading();
            const response = await apiCall(`/api/products/${productId}`, {
                method: 'DELETE'
            });
            
            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            loadProducts(); // Reload the products list
        } catch (error) {
            console.error('Error deleting product:', error);
            showToast('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
}

function openGoogleMaps(address) {
    const encodedAddress = encodeURIComponent(address);
    const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
    window.open(googleMapsUrl, '_blank');
}

function getCurrentLocation() {
    if (!navigator.geolocation) {
        showToast('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'error');
        return;
    }

    showLoading();
    
    navigator.geolocation.getCurrentPosition(
        function(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            
            // Use reverse geocoding to get address from coordinates
            reverseGeocode(latitude, longitude);
        },
        function(error) {
            hideLoading();
            let errorMessage = 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = 'ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­Ø©';
                    break;
                case error.TIMEOUT:
                    errorMessage = 'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                    break;
            }
            
            showToast(errorMessage, 'error');
        },
        {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000
        }
    );
}

function reverseGeocode(latitude, longitude) {
    // Using Google Geocoding API (you'll need to get an API key)
    // For now, we'll use a simple approach with OpenStreetMap Nominatim
    const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&accept-language=ar`;
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            hideLoading();
            
            if (data && data.display_name) {
                // Extract relevant parts of the address
                let address = data.display_name;
                
                // Clean up the address for better readability
                address = address.replace(/ØŒ Ø§Ù„Ø¹Ø±Ø§Ù‚$/, ''); // Remove "ØŒ Iraq" at the end
                address = address.replace(/ØŒ Ù…Ø­Ø§ÙØ¸Ø© [^ØŒ]*$/, ''); // Remove governorate info
                
                // Set the address in the input field
                document.getElementById('productLocation').value = address;
                showToast('ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            } else {
                // Fallback: use coordinates if address lookup fails
                const fallbackAddress = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                document.getElementById('productLocation').value = fallbackAddress;
                showToast('ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§ØªØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'info');
            }
        })
        .catch(error => {
            hideLoading();
            console.error('Geocoding error:', error);
            
            // Fallback: use coordinates
            const fallbackAddress = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
            document.getElementById('productLocation').value = fallbackAddress;
            showToast('ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§ØªØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'info');
        });
}

function convertCurrency() {
    const priceInput = document.getElementById('productPrice');
    const currencySelect = document.getElementById('productCurrency');
    const currentPrice = parseFloat(priceInput.value);
    
    if (!currentPrice || currentPrice <= 0) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­ Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
    }
    
    const currentCurrency = currencySelect.value;
    let newPrice, newCurrency, message;
    
    // Exchange rate: 1 USD = 1500 IQD (approximate rate, you can update this)
    const exchangeRate = 1500;
    
    if (currentCurrency === 'IQD') {
        newPrice = (currentPrice / exchangeRate).toFixed(2);
        newCurrency = 'USD';
        message = `ØªÙ… ØªØ­ÙˆÙŠÙ„ ${currentPrice} Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ Ø¥Ù„Ù‰ ${newPrice} Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ`;
    } else {
        newPrice = (currentPrice * exchangeRate).toFixed(0);
        newCurrency = 'IQD';
        message = `ØªÙ… ØªØ­ÙˆÙŠÙ„ ${currentPrice} Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ Ø¥Ù„Ù‰ ${newPrice} Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ`;
    }
    
    priceInput.value = newPrice;
    currencySelect.value = newCurrency;
    showToast(message, 'success');
}

// Test function to manually submit form
function testFormSubmission() {
    console.log('Testing form submission...');
    
    // Fill in some test data
    document.getElementById('productTitle').value = 'Test Product';
    document.getElementById('productDescription').value = 'Test Description';
    document.getElementById('productPrice').value = '100';
    document.getElementById('productCurrency').value = 'IQD';
    document.getElementById('productCategory').value = 'other';
    document.getElementById('productCity').value = 'Ø¨ØºØ¯Ø§Ø¯';
    document.getElementById('productLocation').value = 'Test Location';
    
    // Trigger form submission
    const form = document.getElementById('postProductForm');
    if (form) {
        form.dispatchEvent(new Event('submit'));
    } else {
        console.error('Form not found for testing');
    }
}

// Test function for filters
function testFilters() {
    console.log('Testing filters...');
    
    // Set some test filter values
    document.getElementById('searchInput').value = 'Ø³ÙŠØ§Ø±Ø©';
    document.getElementById('categoryFilter').value = 'car';
    document.getElementById('cityFilter').value = 'Ø¨ØºØ¯Ø§Ø¯';
    document.getElementById('minPrice').value = '1000';
    document.getElementById('maxPrice').value = '50000';
    
    // Apply filters
    applyFilters();
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    }) + ' ' + date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
}

// Home Page Seller Search functionality
async function searchHomeSellers(query) {
    if (query.length < 2) {
        document.getElementById('homeSellerSearchResults').innerHTML = '';
        return;
    }
    
    try {
        const response = await apiCall(`/api/search-sellers?q=${encodeURIComponent(query)}`);
        
        if (response.sellers && response.sellers.length > 0) {
            displayHomeSellerResults(response.sellers);
        } else {
            document.getElementById('homeSellerSearchResults').innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø§Ø¦Ø¹ÙŠÙ†</p>';
        }
    } catch (error) {
        console.error('Home seller search error:', error);
        document.getElementById('homeSellerSearchResults').innerHTML = '<p class="text-red-500 text-center py-4">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«</p>';
    }
}

function displayHomeSellerResults(sellers) {
    const resultsContainer = document.getElementById('homeSellerSearchResults');
    
    const sellersHtml = sellers.map(seller => `
        <div class="bg-gray-50 dark:bg-slate-700 rounded-xl p-4 border border-gray-200 dark:border-slate-600 hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors">
            <div class="flex items-center space-x-4">
                <div class="h-12 w-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center overflow-hidden">
                    <img src="/api/profile/image/${seller.id}/profile" 
                         alt="${seller.name}" 
                         class="w-full h-full object-cover"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <i class="fas fa-user text-white text-lg" style="display: none;"></i>
                </div>
                <div class="flex-1">
                    <h4 class="font-semibold text-slate-800 dark:text-white">${seller.name}</h4>
                    <p class="text-sm text-slate-600 dark:text-slate-400">${seller.email}</p>
                    ${seller.isVerified ? '<span class="text-xs text-green-500"><i class="fas fa-check-circle ml-1"></i>Ù…Ø¤ÙƒØ¯</span>' : ''}
                </div>
                <div class="flex space-x-2">
                    <button onclick="viewProfile(${seller.id})" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300">
                        <i class="fas fa-user ml-1"></i>Ø§Ù„Ù…Ù„Ù
                    </button>
                    <button onclick="contactSeller(${seller.id})" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300">
                        <i class="fas fa-comment ml-1"></i>Ø±Ø³Ø§Ù„Ø©
                    </button>
                    <button onclick="toggleFollow(${seller.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300">
                        <i class="fas fa-user-plus"></i>
                    </button>
                </div>
            </div>
        </div>
    `).join('');
    
    resultsContainer.innerHTML = sellersHtml;
}

function clearHomeSearch() {
    document.getElementById('homeSellerSearchInput').value = '';
    document.getElementById('homeSellerSearchResults').innerHTML = '';
}

// Seller Search functionality (for sidebar)
async function searchSellers(query) {
    if (query.length < 2) {
        document.getElementById('sellerSearchResults').innerHTML = '';
        return;
    }
    
    try {
        const response = await apiCall(`/api/search-sellers?q=${encodeURIComponent(query)}`);
        
        if (response.sellers && response.sellers.length > 0) {
            displaySellerResults(response.sellers);
        } else {
            document.getElementById('sellerSearchResults').innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø§Ø¦Ø¹ÙŠÙ†</p>';
        }
    } catch (error) {
        console.error('Seller search error:', error);
        document.getElementById('sellerSearchResults').innerHTML = '<p class="text-red-500 text-center py-4">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«</p>';
    }
}

function displaySellerResults(sellers) {
    const resultsContainer = document.getElementById('sellerSearchResults');
    
    const sellersHtml = sellers.map(seller => `
        <div class="bg-gray-50 dark:bg-slate-700 rounded-xl p-4 border border-gray-200 dark:border-slate-600">
            <div class="flex items-center space-x-4">
                <div class="h-12 w-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center overflow-hidden">
                    <img src="/api/profile/image/${seller.id}/profile" 
                         alt="${seller.name}" 
                         class="w-full h-full object-cover"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <i class="fas fa-user text-white text-lg" style="display: none;"></i>
                </div>
                <div class="flex-1">
                    <h4 class="font-semibold text-slate-800 dark:text-white">${seller.name}</h4>
                    <p class="text-sm text-slate-600 dark:text-slate-400">${seller.email}</p>
                    ${seller.isVerified ? '<span class="text-xs text-green-500"><i class="fas fa-check-circle ml-1"></i>Ù…Ø¤ÙƒØ¯</span>' : ''}
                </div>
                <div class="flex space-x-2">
                    <button onclick="viewProfile(${seller.id})" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300">
                        <i class="fas fa-user ml-1"></i>Ø§Ù„Ù…Ù„Ù
                    </button>
                    <button onclick="contactSeller(${seller.id})" class="bg-cyan-500 hover:bg-cyan-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300">
                        <i class="fas fa-comment ml-1"></i>Ø±Ø³Ø§Ù„Ø©
                    </button>
                    <button onclick="toggleFollow(${seller.id})" class="bg-gray-200 dark:bg-slate-600 hover:bg-gray-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-300 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300">
                        <i class="fas fa-user-plus"></i>
                    </button>
                </div>
            </div>
        </div>
    `).join('');
    
    resultsContainer.innerHTML = sellersHtml;
}

// Follow/Unfollow functionality
async function toggleFollow(userId) {
    try {
        // Check current follow status
        const statusResponse = await apiCall(`/api/follow-status/${userId}`);
        
        if (!statusResponse.success) {
            showToast('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©: ' + statusResponse.error, 'error');
            return;
        }
        
        const isFollowing = statusResponse.isFollowing;
        let response;
        
        if (isFollowing) {
            response = await apiCall(`/api/unfollow/${userId}`, { method: 'POST' });
        } else {
            response = await apiCall(`/api/follow/${userId}`, { method: 'POST' });
        }
        
        if (response.success) {
            showToast(response.message, 'success');
        } else {
            showToast(response.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', 'error');
        }
        
    } catch (error) {
        console.error('Follow toggle error:', error);
        showToast(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', 'error');
    }
}

// Category Filtering
let selectedCategory = 'all';

function filterByCategory(category) {
    selectedCategory = category;
    
        // Update button styles
        document.querySelectorAll('.category-btn').forEach(btn => {
            const btnCategory = btn.getAttribute('data-category');
            if (btnCategory === category) {
                // Active state
                btn.className = btn.className.replace('bg-white dark:bg-slate-700', 'bg-gradient-to-r from-emerald-500 to-green-600')
                    .replace('text-gray-700 dark:text-gray-300', 'text-white')
                    .replace('border-2 border-gray-200 dark:border-slate-600', '')
                    .replace('hover:bg-emerald-50 dark:hover:bg-emerald-900/20', 'hover:from-emerald-600 hover:to-green-700')
                    .replace('hover:text-emerald-600 dark:hover:text-emerald-400', '')
                    .replace('hover:border-emerald-300 dark:hover:border-emerald-600', '');
            } else {
                // Inactive state
                btn.className = btn.className.replace('bg-gradient-to-r from-emerald-500 to-green-600', 'bg-white dark:bg-slate-700')
                    .replace('text-white', 'text-gray-700 dark:text-gray-300')
                    .replace('hover:from-emerald-600 hover:to-green-700', 'hover:bg-emerald-50 dark:hover:bg-emerald-900/20')
                    .replace('hover:text-emerald-600 dark:hover:text-emerald-400', 'hover:text-emerald-600 dark:hover:text-emerald-400');
                if (!btn.className.includes('border-2')) {
                    btn.className += ' border-2 border-gray-200 dark:border-slate-600 hover:border-emerald-300 dark:hover:border-emerald-600';
                }
            }
        });
    
    // Reset pagination and load products
    currentPage = 1;
    loadProducts();
    
    // Show loading state
    showToast(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù†ØªØ¬Ø§Øª ${category === 'all' ? 'Ø§Ù„ÙƒÙ„' : getCategoryName(category)}...`, 'info');
}

function getCategoryName(category) {
    const names = {
        'all': 'Ø§Ù„ÙƒÙ„',
        'car': 'Ø³ÙŠØ§Ø±Ø§Øª',
        'home_rental': 'Ø¥ÙŠØ¬Ø§Ø± Ù…Ù†Ø§Ø²Ù„',
        'apartment_rental': 'Ø¥ÙŠØ¬Ø§Ø± Ø´Ù‚Ù‚',
        'job': 'ÙˆØ¸Ø§Ø¦Ù',
        'laptop': 'Ù„Ø§Ø¨ØªÙˆØ¨',
        'electronics': 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª',
        'fashion': 'Ø£Ø²ÙŠØ§Ø¡',
        'furniture': 'Ø£Ø«Ø§Ø«',
        'books': 'ÙƒØªØ¨',
        'sports': 'Ø±ÙŠØ§Ø¶Ø©',
        'other': 'Ø£Ø®Ø±Ù‰'
    };
    return names[category] || category;
}

// Hero Slider Functions
let currentSlide = 0;
const totalSlides = {{ sliderImages|length > 0 ? sliderImages|length : 1 }};

function changeSlide(slideIndex) {
    const slides = document.querySelectorAll('.hero-slide');
    const dots = document.querySelectorAll('.slider-dot');
    
    // Remove active class from all slides and dots
    slides.forEach(slide => slide.classList.remove('active', 'opacity-100'));
    dots.forEach(dot => dot.classList.remove('active'));
    
    // Add active class to current slide and dot
    slides[slideIndex].classList.add('active', 'opacity-100');
    dots[slideIndex].classList.add('active');
    
    currentSlide = slideIndex;
}

function nextSlide() {
    currentSlide = (currentSlide + 1) % totalSlides;
    changeSlide(currentSlide);
}

function previousSlide() {
    currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
    changeSlide(currentSlide);
}

// Auto-slide functionality
function startAutoSlide() {
    setInterval(() => {
        nextSlide();
    }, 5000); // Change slide every 5 seconds
}

// Advanced Filter Functions
function toggleAdvancedFilters() {
    const filtersPanel = document.getElementById('advancedFilters');
    filtersPanel.classList.toggle('hidden');
}

function toggleSellerFilters() {
    const sellerFiltersPanel = document.getElementById('sellerFilters');
    sellerFiltersPanel.classList.toggle('hidden');
}

function clearSellerFilters() {
    document.getElementById('sellerLocationFilter').value = '';
    document.getElementById('sellerCategoryFilter').value = '';
    document.getElementById('sellerRatingFilter').value = '';
    applySellerFilters();
}

function applySellerFilters() {
    const location = document.getElementById('sellerLocationFilter').value;
    const category = document.getElementById('sellerCategoryFilter').value;
    const rating = document.getElementById('sellerRatingFilter').value;
    
    // Apply seller filters logic here
    console.log('Applying seller filters:', { location, category, rating });
    showToast('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†', 'success');
}

// Category Filter Functions
function filterByCategory(category) {
    selectedCategory = category;
    
    // Update category card styles
    document.querySelectorAll('.category-card').forEach(card => {
        const cardCategory = card.getAttribute('data-category');
        if (cardCategory === category) {
            // Active state
            card.className = card.className.replace('bg-white dark:bg-slate-800', 'bg-gradient-to-br from-emerald-500 to-green-600')
                .replace('text-gray-900 dark:text-white', 'text-white')
                .replace('border border-gray-200 dark:border-slate-600', '')
                .replace('hover:bg-gradient-to-br hover:from-', 'hover:from-emerald-600 hover:to-green-700')
                .replace('hover:text-gray-900 dark:hover:text-white', '')
                .replace('hover:shadow-xl', 'hover:shadow-2xl');
            
            // Update icon colors
            const icon = card.querySelector('i');
            if (icon) {
                icon.className = icon.className.replace(/text-\w+-\d+/, 'text-white');
            }
            
            // Update text colors
            card.querySelectorAll('h3, p').forEach(text => {
                text.className = text.className.replace('text-gray-900 dark:text-white', 'text-white')
                    .replace('text-gray-600 dark:text-gray-400', 'text-white/90');
            });
        } else {
            // Reset to inactive state
            card.className = card.className.replace('bg-gradient-to-br from-emerald-500 to-green-600', 'bg-white dark:bg-slate-800')
                .replace('text-white', 'text-gray-900 dark:text-white')
                .replace('hover:from-emerald-600 hover:to-green-700', 'hover:bg-gradient-to-br hover:from-gray-50 hover:to-gray-100 dark:hover:from-slate-700 dark:hover:to-slate-600')
                .replace('hover:shadow-2xl', 'hover:shadow-xl');
            
            if (!card.className.includes('border border-gray-200 dark:border-slate-600')) {
                card.className += ' border border-gray-200 dark:border-slate-600';
            }
        }
    });
    
    // Reset pagination and load products
    currentPage = 1;
    loadProducts();
    
    // Show loading state
    showToast(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù†ØªØ¬Ø§Øª ${category === 'all' ? 'Ø§Ù„ÙƒÙ„' : getCategoryName(category)}...`, 'info');
}

// Search for sellers function
function searchForSellers() {
    document.getElementById('mainSearchInput').value = '';
    document.getElementById('mainSearchInput').focus();
    showToast('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†', 'info');
}

// Contact seller function
function contactSeller(sellerId) {
    window.location.href = `/messages?seller=${sellerId}`;
}

// View seller profile function
function viewSellerProfile(sellerId) {
    window.location.href = `/profile/${sellerId}`;
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    // Set current user ID for JavaScript functions
    {% if user %}
    window.currentUserId = {{ user.id }};
    {% else %}
    window.currentUserId = null;
    {% endif %}
    
    // Initialize slider
    startAutoSlide();
    
    loadProducts();
    
    // Start real-time updates for messages and notifications
    startRealTimeUpdates();
    
    // Request notification permission
    requestNotificationPermission();
    
    // Test function for debugging (remove in production)
    
    
    
    // Add filter input listeners
    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');
    const cityFilter = document.getElementById('cityFilter');
    const minPrice = document.getElementById('minPrice');
    const maxPrice = document.getElementById('maxPrice');
    
    if (searchInput) {
        searchInput.addEventListener('input', debounce(function() {
            showSearchLoading();
            applyFilters();
        }, 500));
        
        searchInput.addEventListener('focus', function() {
            this.parentElement.classList.add('ring-4', 'ring-emerald-500/20');
        });
        
        searchInput.addEventListener('blur', function() {
            this.parentElement.classList.remove('ring-4', 'ring-emerald-500/20');
        });
    }
    if (categoryFilter) categoryFilter.addEventListener('change', applyFilters);
    if (cityFilter) cityFilter.addEventListener('change', applyFilters);
    if (minPrice) minPrice.addEventListener('input', debounce(applyFilters, 500));
    if (maxPrice) maxPrice.addEventListener('input', debounce(applyFilters, 500));
    
    // Add seller search listener
    const homeSellerSearchInput = document.getElementById('homeSellerSearchInput');
    if (homeSellerSearchInput) {
        homeSellerSearchInput.addEventListener('input', debounce(function(e) {
            searchHomeSellers(e.target.value);
        }, 300));
    }
    
    // Add main search listener
    const mainSearchInput = document.getElementById('mainSearchInput');
    if (mainSearchInput) {
        mainSearchInput.addEventListener('input', debounce(function(e) {
            const query = e.target.value.trim();
            if (query.length >= 2) {
                // Perform search as you type
                console.log('Performing search for:', query);
                performMainSearch();
            } else if (query.length === 0) {
                // Clear search and show all products
                currentPage = 1;
                selectedCategory = 'all';
                // Clear seller results
                const existingSellerResults = document.getElementById('sellerResults');
                if (existingSellerResults) {
                    existingSellerResults.remove();
                }
                loadProducts();
                document.getElementById('searchSuggestions').classList.add('hidden');
            }
        }, 800)); // Increased delay to avoid too many API calls
        
        // Add Enter key listener for immediate search
        mainSearchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const query = e.target.value.trim();
                if (query.length >= 2) {
                    performMainSearch();
                }
            }
        });
    }
});

// Main search function for both products and sellers
function performMainSearch() {
    const searchQuery = document.getElementById('mainSearchInput').value.trim();
    
    if (!searchQuery) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«', 'warning');
        return;
    }
    
    console.log('performMainSearch called with:', searchQuery);
    
    // Reset to first page
    currentPage = 1;
    
    // Show search is happening
    showToast(`Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${searchQuery}"...`, 'info');
    
    // Perform search for both products and sellers
    searchProductsAndSellers(searchQuery);
}

async function searchProductsAndSellers(query) {
    try {
        console.log('Searching for:', query);
        
        // Show loading state
        document.getElementById('loadingState').classList.remove('hidden');
        document.getElementById('emptyState').classList.add('hidden');
        document.getElementById('pagination').classList.add('hidden');
        
        // Clear any existing seller results
        const existingSellerResults = document.getElementById('sellerResults');
        if (existingSellerResults) {
            existingSellerResults.remove();
        }
        
        // Search for products
        const productParams = new URLSearchParams({
            search: query,
            page: currentPage,
            limit: 12
        });
        
        console.log('Searching products with:', productParams.toString());
        const productResponse = await apiCall(`/api/products?${productParams.toString()}`);
        console.log('Product response:', productResponse);
        
        // Search for sellers
        const sellerParams = new URLSearchParams({
            search: query,
            page: 1,
            limit: 6
        });
        
        console.log('Searching sellers with:', sellerParams.toString());
        const sellerResponse = await apiCall(`/api/users/search?${sellerParams.toString()}`);
        console.log('Seller response:', sellerResponse);
        
        // Update pagination info
        totalProducts = productResponse.pagination?.total || productResponse.products?.length || 0;
        totalPages = Math.ceil(totalProducts / 12);
        
        // Hide loading state
        document.getElementById('loadingState').classList.add('hidden');
        
        // Display seller results first if any
        if (sellerResponse.users && sellerResponse.users.length > 0) {
            showSellerResults(sellerResponse.users);
        }
        
        // Display product results
        if (productResponse.products && productResponse.products.length > 0) {
            renderProducts(productResponse.products);
            
            if (sellerResponse.users && sellerResponse.users.length > 0) {
                showToast(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${sellerResponse.users.length} Ø¨Ø§Ø¦Ø¹ Ùˆ ${totalProducts} Ù…Ù†ØªØ¬`, 'success');
            } else {
                showToast(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${totalProducts} Ù…Ù†ØªØ¬`, 'success');
            }
        } else if (sellerResponse.users && sellerResponse.users.length > 0) {
            // Show only seller results
            document.getElementById('productsGrid').innerHTML = '';
            document.getElementById('emptyState').classList.add('hidden');
            showToast(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${sellerResponse.users.length} Ø¨Ø§Ø¦Ø¹`, 'success');
        } else {
            // No results found
            document.getElementById('productsGrid').innerHTML = '';
            document.getElementById('emptyState').classList.remove('hidden');
            showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬', 'info');
        }
        
    } catch (error) {
        console.error('Search error:', error);
        document.getElementById('loadingState').classList.add('hidden');
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: ' + error.message, 'error');
    }
}

function showSellerResults(sellers) {
    // Remove any existing seller results
    const existingSellerResults = document.getElementById('sellerResults');
    if (existingSellerResults) {
        existingSellerResults.remove();
    }
    
    // Create seller results section
    const sellerResultsHTML = `
        <div id="sellerResults" class="col-span-full mb-8">
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl p-6 border border-purple-200 dark:border-purple-700 mb-6">
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                    <i class="fas fa-users ml-2 text-purple-500"></i>Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ† Ù„Ù„Ø¨Ø­Ø«
                </h3>
                <p class="text-gray-600 dark:text-gray-400">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${sellers.length} Ø¨Ø§Ø¦Ø¹ ÙŠØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                ${sellers.map(seller => `
                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-gray-200 dark:border-slate-600 p-6 hover:shadow-xl transition-all duration-300">
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="h-12 w-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center overflow-hidden">
                                <img src="/api/profile/image/${seller.id}/profile" 
                                     alt="${seller.name}" 
                                     class="w-full h-full object-cover"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <i class="fas fa-user text-white" style="display: none;"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">${seller.name}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">${seller.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <button onclick="contactSeller(${seller.id})" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-lg font-medium hover:from-purple-600 hover:to-pink-600 transition-all duration-300">
                                <i class="fas fa-comments ml-1"></i>Ø±Ø³Ø§Ù„Ø©
                            </button>
                            <button onclick="viewSellerProfile(${seller.id})" class="bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-slate-600 transition-all duration-300">
                                <i class="fas fa-eye ml-1"></i>Ø¹Ø±Ø¶
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    
    // Insert seller results before products grid
    const productsGrid = document.getElementById('productsGrid');
    productsGrid.insertAdjacentHTML('beforebegin', sellerResultsHTML);
}

// Search Suggestions Function
function showSearchSuggestions(query) {
    const suggestionsContainer = document.getElementById('searchSuggestions');
    
    if (query.length < 2) {
        suggestionsContainer.classList.add('hidden');
        return;
    }
    
    // Mock suggestions - replace with actual API call
    const suggestions = [
        { type: 'product', text: 'Ù‡Ø§ØªÙ Ø¢ÙŠÙÙˆÙ†', category: 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª' },
        { type: 'product', text: 'Ø³ÙŠØ§Ø±Ø© ØªÙˆÙŠÙˆØªØ§', category: 'Ø³ÙŠØ§Ø±Ø§Øª' },
        { type: 'seller', text: 'Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª', category: 'Ø¨Ø§Ø¦Ø¹' },
        { type: 'seller', text: 'Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', category: 'Ø¨Ø§Ø¦Ø¹' },
        { type: 'category', text: 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', count: '150 Ù…Ù†ØªØ¬' }
    ];
    
    const filteredSuggestions = suggestions.filter(item => 
        item.text.toLowerCase().includes(query.toLowerCase())
    );
    
    if (filteredSuggestions.length > 0) {
        suggestionsContainer.innerHTML = filteredSuggestions.map(item => `
            <div class="p-4 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer border-b border-gray-100 dark:border-slate-600 last:border-b-0" onclick="selectSuggestion('${item.text}')">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-emerald-400 to-blue-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-${item.type === 'product' ? 'box' : item.type === 'seller' ? 'store' : 'th-large'} text-white text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-gray-900 dark:text-white">${item.text}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">${item.category || item.location || item.count}</p>
                    </div>
                </div>
            </div>
        `).join('');
        suggestionsContainer.classList.remove('hidden');
    } else {
        suggestionsContainer.classList.add('hidden');
    }
}

function selectSuggestion(text) {
    document.getElementById('mainSearchInput').value = text;
    document.getElementById('searchSuggestions').classList.add('hidden');
    performMainSearch();
}

// Dynamic Messages and Notifications Functions
async function loadMessagesCount() {
    try {
        console.log('Loading messages count from home page...');
        const response = await apiCall('/web/conversations');
        const count = response.unreadCount || 0;
        console.log('Messages count received:', count);
        lastMessageCount = count; // Set initial count
        updateMessagesBadge(count);
    } catch (error) {
        console.error('Error loading messages count:', error);
        updateMessagesBadge(0);
    }
}

async function loadNotificationsCount() {
    try {
        const response = await apiCall('/web/notifications/unread-count');
        const count = response.count || 0;
        updateNotificationsBadge(count);
    } catch (error) {
        console.error('Error loading notifications count:', error);
        updateNotificationsBadge(0);
    }
}

function updateMessagesBadge(count) {
    const badge = document.getElementById('messagesCount');
    if (badge) {
        console.log('Updating messages badge with count:', count);
        if (count > 0) {
            badge.textContent = count > 99 ? '99+' : count;
            badge.classList.remove('hidden');
            console.log('Messages badge shown with count:', count);
        } else {
            badge.classList.add('hidden');
            console.log('Messages badge hidden');
        }
    } else {
        console.error('Messages badge element not found');
    }
}

function updateNotificationsBadge(count) {
    const badge = document.getElementById('notificationsCount');
    if (badge) {
        console.log('Updating notifications badge with count:', count);
        if (count > 0) {
            badge.textContent = count > 99 ? '99+' : count;
            badge.classList.remove('hidden');
            console.log('Notifications badge shown with count:', count);
        } else {
            badge.classList.add('hidden');
            console.log('Notifications badge hidden');
        }
    } else {
        console.error('Notifications badge element not found');
    }
}

function openMessages() {
    window.location.href = '/messages';
}

function openNotifications() {
    window.location.href = '/notifications';
}

// Function to go to My Products page with authentication check
async function goToMyProducts() {
    try {
        // Check if user is authenticated by making a simple API call
        await apiCall('/web/conversations');
        
        // If we get here, user is authenticated, redirect to My Products page
        window.location.href = '/products/my';
    } catch (error) {
        console.error('Authentication check failed:', error);
        showToast('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
        setTimeout(() => {
            window.location.href = '/login';
        }, 2000);
    }
}

// Real-time updates using polling (you can replace with WebSocket later)
function startRealTimeUpdates() {
    // Load initial counts
    loadMessagesCount();
    loadNotificationsCount();
    
    // Update counts every 30 seconds
    setInterval(() => {
        loadMessagesCount();
        loadNotificationsCount();
    }, 30000);
    
    // Check for new messages every 10 seconds for toast notifications
    setInterval(() => {
        checkForNewMessages();
    }, 10000);
}

// Check for new messages and show toast notifications
let lastMessageCount = 0;
async function checkForNewMessages() {
    try {
        console.log('Checking for new messages (home page)');
        const response = await apiCall('/web/conversations');
        const currentCount = response.unreadCount || 0;
        console.log('Current message count:', currentCount, 'Last count:', lastMessageCount);
        
        // If there are new messages (count increased)
        if (currentCount > lastMessageCount && lastMessageCount > 0) {
            const newMessages = currentCount - lastMessageCount;
            console.log('New messages detected:', newMessages);
            showToast(`Ù„Ø¯ÙŠÙƒ ${newMessages} Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©`, 'info');
            
            // Show browser notification if page is not focused
            if (document.hidden || !document.hasFocus()) {
                showBrowserNotification({
                    title: 'Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                    message: `Ù„Ø¯ÙŠÙƒ ${newMessages} Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©`,
                    icon: '/favicon.ico'
                });
            }
        }
        
        lastMessageCount = currentCount;
        updateMessagesBadge(currentCount);
    } catch (error) {
        console.error('Error checking for new messages:', error);
        if (error.message === 'Authentication required') {
            console.log('User not authenticated, stopping real-time updates');
        }
    }
}

// Browser notification function
function showBrowserNotification(notification) {
    if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(notification.title, {
            body: notification.message,
            icon: notification.icon || '/favicon.ico',
            badge: '/favicon.ico'
        });
    }
}

// Request notification permission
function requestNotificationPermission() {
    if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission();
    }
}


function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
</script>
{% endblock %}