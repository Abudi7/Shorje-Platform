{% extends 'base.html.twig' %}

{% block title %}Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ - Ø´ÙˆØ±Ø¬ÙŠ{% endblock %}

{% block body %}
{% include 'components/home_navigation.html.twig' %}

<style>
    /* Custom animations and styles */
    .glass {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
    }
    
    .glass-dark {
        background: rgba(15, 23, 42, 0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .gradient-text {
        background: linear-gradient(135deg, #10b981, #3b82f6, #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .form-group {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .form-group:focus-within {
        transform: translateY(-2px);
    }
    
    /* Image Gallery Styles */
    .image-preview {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .image-preview:hover {
        transform: scale(1.02);
    }
    
    /* Image Modal Styles */
    #imageModal {
        backdrop-filter: blur(8px);
        animation: fadeIn 0.3s ease-out;
    }
    
    #imageModal.hidden {
        animation: fadeOut 0.3s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
    
    /* Responsive Image Gallery */
    @media (max-width: 640px) {
        .aspect-video {
            aspect-ratio: 16/9;
        }
        
        .grid.grid-cols-2 {
            gap: 0.5rem;
        }
        
        .aspect-square {
            aspect-ratio: 1/1;
        }
    }
    
    @media (max-width: 480px) {
        .aspect-video {
            aspect-ratio: 4/3;
        }
        
        .grid.grid-cols-2 {
            gap: 0.375rem;
        }
    }
    
    /* Touch device optimizations for images */
    @media (hover: none) and (pointer: coarse) {
        .image-preview:hover {
            transform: none;
        }
        
        .group-hover\\:scale-110:hover {
            transform: none;
        }
        
        /* Make images clickable on touch devices */
        .group:hover .group-hover\\:opacity-100 {
            opacity: 0.7;
        }
    }
    
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #2563eb, #7c3aed);
    }
    
    /* Responsive Design Enhancements */
    @media (max-width: 640px) {
        .form-container {
            @apply p-4 rounded-xl;
        }
        
        .form-group {
            @apply mb-4;
        }
        
        .btn-primary {
            @apply py-3 px-4 text-sm;
        }
    }
    
    @media (max-width: 480px) {
        .form-container {
            @apply p-3 rounded-lg;
        }
        
        .btn-primary {
            @apply py-2 px-3 text-xs;
        }
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-green-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900">
    <div class="max-w-4xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 md:py-8">
        <!-- Page Header -->
        <div class="text-center mb-6 sm:mb-8 md:mb-12">
            <div class="inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-r from-emerald-500 to-blue-600 rounded-2xl shadow-xl mb-4 sm:mb-6">
                <i class="fas fa-plus text-white text-2xl sm:text-3xl"></i>
            </div>
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2 sm:mb-3 md:mb-4">
                Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
            </h1>
            <p class="text-sm sm:text-base md:text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto px-2 sm:px-4">
                Ø´Ø§Ø±Ùƒ Ù…Ù†ØªØ¬Ùƒ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙˆØ§Ø¨Ø¯Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ¹
            </p>
        </div>

        <!-- Add Product Form -->
        <div class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl sm:rounded-3xl shadow-2xl border border-white/20 dark:border-slate-700/20 form-container p-4 sm:p-6 md:p-8">
            <form id="addProductForm" class="space-y-4 sm:space-y-6 md:space-y-8">
                <!-- Product Title -->
                <div class="form-group">
                    <label for="title" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300 mb-2 sm:mb-3">
                        <i class="fas fa-tag ml-1 sm:ml-2 text-emerald-500"></i>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬
                    </label>
                    <input 
                        type="text" 
                        id="title" 
                        name="title" 
                        required 
                        class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 transition-all duration-300 text-sm sm:text-base"
                        placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬"
                    >
                </div>

                <!-- Product Description -->
                <div class="form-group">
                    <label for="description" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300 mb-2 sm:mb-3">
                        <i class="fas fa-align-right ml-1 sm:ml-2 text-emerald-500"></i>ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬
                    </label>
                    <textarea 
                        id="description" 
                        name="description" 
                        rows="4" 
                        required 
                        class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 transition-all duration-300 text-sm sm:text-base resize-none"
                        placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ù…ÙØµÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬"
                    ></textarea>
                </div>

                <!-- Price and Currency -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                    <div class="form-group">
                        <label for="price" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300 mb-2 sm:mb-3">
                            <i class="fas fa-dollar-sign ml-1 sm:ml-2 text-emerald-500"></i>Ø§Ù„Ø³Ø¹Ø±
                        </label>
                        <input 
                            type="number" 
                            id="price" 
                            name="price" 
                            required 
                            min="0" 
                            step="0.01"
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 transition-all duration-300 text-sm sm:text-base"
                            placeholder="0.00"
                        >
                    </div>
                    <div class="form-group">
                        <label for="currency" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300 mb-2 sm:mb-3">
                            <i class="fas fa-coins ml-1 sm:ml-2 text-emerald-500"></i>Ø§Ù„Ø¹Ù…Ù„Ø©
                        </label>
                        <select 
                            id="currency" 
                            name="currency" 
                            required 
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white transition-all duration-300 text-sm sm:text-base"
                        >
                            <option value="IQD">Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ (IQD)</option>
                            <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                            <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Currency Conversion -->
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2">
                    <p class="text-xs text-gray-500 dark:text-slate-400">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</p>
                    <button type="button" onclick="convertCurrency()" class="text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 px-3 py-2 rounded-lg hover:bg-green-200 dark:hover:bg-green-800 transition-colors flex items-center">
                        <i class="fas fa-exchange-alt ml-1"></i>ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø©
                    </button>
                </div>

                <!-- Category and City -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                    <div class="form-group">
                        <label for="category" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300 mb-2 sm:mb-3">
                            <i class="fas fa-th-large ml-1 sm:ml-2 text-emerald-500"></i>Ø§Ù„ÙØ¦Ø©
                        </label>
                        <select 
                            id="category" 
                            name="category" 
                            required 
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white transition-all duration-300 text-sm sm:text-base"
                        >
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                            <option value="car">ğŸš— Ø³ÙŠØ§Ø±Ø§Øª</option>
                            <option value="home_rental">ğŸ  Ø¥ÙŠØ¬Ø§Ø± Ù…Ù†Ø§Ø²Ù„</option>
                            <option value="apartment_rental">ğŸ¢ Ø¥ÙŠØ¬Ø§Ø± Ø´Ù‚Ù‚</option>
                            <option value="job">ğŸ’¼ ÙˆØ¸Ø§Ø¦Ù</option>
                            <option value="laptop">ğŸ’» Ù„Ø§Ø¨ØªÙˆØ¨</option>
                            <option value="electronics">ğŸ“± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                            <option value="fashion">ğŸ‘• Ø£Ø²ÙŠØ§Ø¡</option>
                            <option value="furniture">ğŸª‘ Ø£Ø«Ø§Ø«</option>
                            <option value="books">ğŸ“š ÙƒØªØ¨</option>
                            <option value="sports">âš½ Ø±ÙŠØ§Ø¶Ø©</option>
                            <option value="other">ğŸ“¦ Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="city" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300 mb-2 sm:mb-3">
                            <i class="fas fa-map-marker-alt ml-1 sm:ml-2 text-emerald-500"></i>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
                        </label>
                        <select 
                            id="city" 
                            name="city" 
                            required 
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white transition-all duration-300 text-sm sm:text-base"
                        >
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                            <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
                            <option value="Ø§Ù„Ø¨ØµØ±Ø©">Ø§Ù„Ø¨ØµØ±Ø©</option>
                            <option value="Ù†ÙŠÙ†ÙˆÙ‰">Ù†ÙŠÙ†ÙˆÙ‰ (Ø§Ù„Ù…ÙˆØµÙ„)</option>
                            <option value="Ø£Ø±Ø¨ÙŠÙ„">Ø£Ø±Ø¨ÙŠÙ„</option>
                            <option value="Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©">Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option>
                            <option value="Ø¯Ù‡ÙˆÙƒ">Ø¯Ù‡ÙˆÙƒ</option>
                            <option value="ÙƒØ±Ø¨Ù„Ø§Ø¡">ÙƒØ±Ø¨Ù„Ø§Ø¡</option>
                            <option value="Ø§Ù„Ù†Ø¬Ù">Ø§Ù„Ù†Ø¬Ù</option>
                            <option value="ÙƒØ±ÙƒÙˆÙƒ">ÙƒØ±ÙƒÙˆÙƒ</option>
                            <option value="ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†">ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ† (ØªÙƒØ±ÙŠØª)</option>
                            <option value="Ø¯ÙŠØ§Ù„Ù‰">Ø¯ÙŠØ§Ù„Ù‰ (Ø¨Ø¹Ù‚ÙˆØ¨Ø©)</option>
                            <option value="Ø§Ù„Ø£Ù†Ø¨Ø§Ø±">Ø§Ù„Ø£Ù†Ø¨Ø§Ø± (Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ)</option>
                            <option value="ÙˆØ§Ø³Ø·">ÙˆØ§Ø³Ø· (Ø§Ù„ÙƒÙˆØª)</option>
                            <option value="Ø¨Ø§Ø¨Ù„">Ø¨Ø§Ø¨Ù„ (Ø§Ù„Ø­Ù„Ø©)</option>
                            <option value="Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©">Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ© (Ø§Ù„Ø¯ÙŠÙˆØ§Ù†ÙŠØ©)</option>
                            <option value="Ø°ÙŠ Ù‚Ø§Ø±">Ø°ÙŠ Ù‚Ø§Ø± (Ø§Ù„Ù†Ø§ØµØ±ÙŠØ©)</option>
                            <option value="Ø§Ù„Ù…Ø«Ù†Ù‰">Ø§Ù„Ù…Ø«Ù†Ù‰ (Ø§Ù„Ø³Ù…Ø§ÙˆØ©)</option>
                            <option value="Ù…ÙŠØ³Ø§Ù†">Ù…ÙŠØ³Ø§Ù† (Ø§Ù„Ø¹Ù…Ø§Ø±Ø©)</option>
                        </select>
                    </div>
                </div>

                <!-- Location -->
                <div class="form-group">
                    <div class="flex items-center justify-between mb-2 sm:mb-3">
                        <label for="location" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300">
                            <i class="fas fa-location-dot ml-1 sm:ml-2 text-emerald-500"></i>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
                        </label>
                        <button type="button" onclick="useMyLocation(this)" class="inline-flex items-center text-xs sm:text-sm bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 px-3 py-1.5 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors">
                            <i class="fas fa-crosshairs ml-2"></i>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ
                        </button>
                    </div>
                    <input 
                        type="text" 
                        id="location" 
                        name="location" 
                        required
                        class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-slate-400 transition-all duration-300 text-sm sm:text-base"
                        placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ÙƒØ±Ø§Ø¯Ø©ØŒ Ø¨ØºØ¯Ø§Ø¯"
                    >
                    <p id="locationHint" class="mt-2 text-xs text-gray-500 dark:text-slate-400 hidden"></p>
                </div>

                <!-- Condition and Color -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                    <div class="form-group">
                        <label for="condition" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300 mb-2 sm:mb-3">
                            <i class="fas fa-star ml-1 sm:ml-2 text-emerald-500"></i>Ø§Ù„Ø­Ø§Ù„Ø©
                        </label>
                        <select 
                            id="condition" 
                            name="condition" 
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white transition-all duration-300 text-sm sm:text-base"
                        >
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
                            <option value="new">Ø¬Ø¯ÙŠØ¯</option>
                            <option value="like_new">ÙƒØ§Ù„Ø¬Ø¯ÙŠØ¯</option>
                            <option value="good">Ø¬ÙŠØ¯</option>
                            <option value="fair">Ù…Ù‚Ø¨ÙˆÙ„</option>
                            <option value="poor">Ø¶Ø¹ÙŠÙ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="color" class="block text-sm sm:text-base font-semibold text-gray-700 dark:text-gray-300 mb-2 sm:mb-3">
                            <i class="fas fa-palette ml-1 sm:ml-2 text-emerald-500"></i>Ø§Ù„Ù„ÙˆÙ†
                        </label>
                        <select 
                            id="color" 
                            name="color" 
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 dark:border-slate-600 rounded-xl sm:rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-white transition-all duration-300 text-sm sm:text-base"
                        >
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†</option>
                            <option value="red">Ø£Ø­Ù…Ø±</option>
                            <option value="blue">Ø£Ø²Ø±Ù‚</option>
                            <option value="green">Ø£Ø®Ø¶Ø±</option>
                            <option value="black">Ø£Ø³ÙˆØ¯</option>
                            <option value="white">Ø£Ø¨ÙŠØ¶</option>
                            <option value="gray">Ø±Ù…Ø§Ø¯ÙŠ</option>
                            <option value="yellow">Ø£ØµÙØ±</option>
                            <option value="orange">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</option>
                            <option value="purple">Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                            <option value="pink">ÙˆØ±Ø¯ÙŠ</option>
                            <option value="brown">Ø¨Ù†ÙŠ</option>
                            <option value="silver">ÙØ¶ÙŠ</option>
                            <option value="gold">Ø°Ù‡Ø¨ÙŠ</option>
                            <option value="beige">Ø¨ÙŠØ¬</option>
                            <option value="navy">ÙƒØ­Ù„ÙŠ</option>
                            <option value="teal">ØªØ±ÙƒÙˆØ§Ø²ÙŠ</option>
                            <option value="maroon">Ø®Ù…Ø±ÙŠ</option>
                            <option value="olive">Ø²ÙŠØªÙŠ</option>
                            <option value="cyan">Ø³Ù…Ø§ÙˆÙŠ</option>
                            <option value="magenta">Ù…Ø§Ø¬Ù†ØªØ§</option>
                        </select>
                    </div>
                </div>

                <!-- Image Upload -->
                <div class="form-group">
                    <label class="flex items-center text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">
                        <i class="fas fa-images ml-2 text-purple-500"></i>ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </label>
                    
                    <!-- Main Image Display -->
                    <div class="mb-4">
                        <div class="relative">
                            <div class="aspect-video bg-white dark:bg-slate-800 rounded-xl border-2 border-dashed border-purple-300 dark:border-purple-600 flex items-center justify-center cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group" onclick="selectImage(1)">
                                <input type="file" id="image1" accept="image/*" style="display: none;" onchange="handleImagePreview(1)">
                                <div id="image1Preview" class="text-center w-full h-full flex items-center justify-center">
                                    <div class="text-center">
                                        <i class="fas fa-camera text-3xl sm:text-4xl text-purple-400 group-hover:text-purple-600 dark:group-hover:text-purple-300 mb-2 transition-colors"></i>
                                        <p class="text-sm sm:text-base text-purple-600 dark:text-purple-400 font-medium">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Thumbnail Gallery -->
                    <div class="grid grid-cols-2 gap-3">
                        <div class="aspect-square bg-white dark:bg-slate-800 rounded-lg border-2 border-dashed border-purple-300 dark:border-purple-600 flex items-center justify-center cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group relative overflow-hidden" onclick="selectImage(2)">
                            <input type="file" id="image2" accept="image/*" style="display: none;" onchange="handleImagePreview(2)">
                            <div id="image2Preview" class="text-center w-full h-full flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fas fa-camera text-lg sm:text-xl text-purple-400 group-hover:text-purple-600 dark:group-hover:text-purple-300 mb-1 transition-colors"></i>
                                    <p class="text-xs sm:text-sm text-purple-600 dark:text-purple-400 font-medium">ØµÙˆØ±Ø© 2</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="aspect-square bg-white dark:bg-slate-800 rounded-lg border-2 border-dashed border-purple-300 dark:border-purple-600 flex items-center justify-center cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 group relative overflow-hidden" onclick="selectImage(3)">
                            <input type="file" id="image3" accept="image/*" style="display: none;" onchange="handleImagePreview(3)">
                            <div id="image3Preview" class="text-center w-full h-full flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fas fa-camera text-lg sm:text-xl text-purple-400 group-hover:text-purple-600 dark:group-hover:text-purple-300 mb-1 transition-colors"></i>
                                    <p class="text-xs sm:text-sm text-purple-600 dark:text-purple-400 font-medium">ØµÙˆØ±Ø© 3</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Image Gallery Modal -->
                    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
                        <div class="max-w-4xl max-h-[90vh] p-4 relative">
                            <img id="modalImage" src="" alt="" class="max-w-full max-h-full object-contain rounded-lg">
                            <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white text-2xl hover:text-gray-300 bg-black/50 rounded-full w-10 h-10 flex items-center justify-center">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-4 sm:pt-6">
                    <button 
                        type="submit" 
                        class="flex-1 bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl sm:rounded-2xl font-semibold text-sm sm:text-base transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105"
                    >
                        <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
                    </button>
                    <button 
                        type="button" 
                        onclick="window.history.back()" 
                        class="px-6 sm:px-8 py-3 sm:py-4 border-2 border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-xl sm:rounded-2xl font-semibold text-sm sm:text-base hover:bg-gray-50 dark:hover:bg-slate-700 transition-all duration-300"
                    >
                        <i class="fas fa-arrow-right ml-2"></i>Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Image handling functions
function selectImage(imageNumber) {
    document.getElementById(`image${imageNumber}`).click();
}

function handleImagePreview(imageNumber) {
    const file = document.getElementById(`image${imageNumber}`).files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById(`image${imageNumber}Preview`);
            if (imageNumber === 1) {
                // Main image - full display
                preview.innerHTML = `<img src="${e.target.result}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" class="w-full h-full object-cover rounded-xl">`;
            } else {
                // Thumbnail images - with hover effects
                preview.innerHTML = `
                    <img src="${e.target.result}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300 cursor-pointer" onclick="event.stopPropagation(); openImageModal(this.src)">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-expand text-white text-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"></i>
                    </div>
                `;
            }
        };
        reader.readAsDataURL(file);
    }
}

// Image modal functions
function openImageModal(imageSrc) {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    modalImage.src = imageSrc;
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.classList.add('hidden');
    document.body.style.overflow = 'auto';
}

// Use browser geolocation to fill location
async function useMyLocation(btn) {
    const hint = document.getElementById('locationHint');
    const input = document.getElementById('location');
    const citySelect = document.getElementById('city');
    if (!navigator.geolocation) {
        showToast('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'error');
        return;
    }
    try {
        btn && (btn.disabled = true);
        hint.classList.remove('hidden');
        hint.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...';

        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true, timeout: 10000 });
        });
        const { latitude, longitude } = position.coords;
        // Always fill coordinates as a reliable fallback
        input.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
        hint.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø±ÙŠØ¨...';

        // Try reverse geocoding (OpenStreetMap Nominatim)
        try {
            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}&accept-language=ar`);
            if (res.ok) {
                const data = await res.json();
                const road = data.address?.road || '';
                const suburb = data.address?.suburb || '';
                const city = data.address?.city || data.address?.town || data.address?.village || data.address?.state || '';
                const display = [road, suburb, city].filter(Boolean).join('ØŒ ');
                if (display) {
                    input.value = display;
                    hint.textContent = `Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­: ${display}`;
                } else {
                    hint.textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª. Ù„Ù… ÙŠÙØ¹Ø«Ø± Ø¹Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ù†ØµÙŠ.';
                }

                // Try to auto-select city from dropdown
                if (citySelect && city) {
                    const cityText = city.toString();
                    // Map common Arabic/English names to dropdown values
                    const map = [
                        { k: ['Ø¨ØºØ¯Ø§Ø¯','Baghdad'], v: 'Ø¨ØºØ¯Ø§Ø¯' },
                        { k: ['Ø§Ù„Ø¨ØµØ±Ø©','Basra','Al Basrah'], v: 'Ø§Ù„Ø¨ØµØ±Ø©' },
                        { k: ['Ø§Ù„Ù…ÙˆØµÙ„','Ù†ÙŠÙ†ÙˆÙ‰','Nineveh','Mosul'], v: 'Ù†ÙŠÙ†ÙˆÙ‰' },
                        { k: ['Ø£Ø±Ø¨ÙŠÙ„','Erbil','Hewler'], v: 'Ø£Ø±Ø¨ÙŠÙ„' },
                        { k: ['Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©','Sulaymaniyah','Sulaimani'], v: 'Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©' },
                        { k: ['Ø¯Ù‡ÙˆÙƒ','Duhok','Dohuk'], v: 'Ø¯Ù‡ÙˆÙƒ' },
                        { k: ['ÙƒØ±ÙƒÙˆÙƒ','Kirkuk'], v: 'ÙƒØ±ÙƒÙˆÙƒ' },
                        { k: ['ÙƒØ±Ø¨Ù„Ø§Ø¡','Karbala'], v: 'ÙƒØ±Ø¨Ù„Ø§Ø¡' },
                        { k: ['Ø§Ù„Ù†Ø¬Ù','Najaf'], v: 'Ø§Ù„Ù†Ø¬Ù' },
                        { k: ['ØªÙƒØ±ÙŠØª','ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†','Salah ad Din','Tikrit'], v: 'ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†' },
                        { k: ['Ø¨Ø¹Ù‚ÙˆØ¨Ø©','Ø¯ÙŠØ§Ù„Ù‰','Diyala','Baqubah'], v: 'Ø¯ÙŠØ§Ù„Ù‰' },
                        { k: ['Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ','Ø§Ù„Ø£Ù†Ø¨Ø§Ø±','Anbar','Ramadi'], v: 'Ø§Ù„Ø£Ù†Ø¨Ø§Ø±' },
                        { k: ['Ø§Ù„Ø­Ù„Ø©','Ø¨Ø§Ø¨Ù„','Babil','Hillah'], v: 'Ø¨Ø§Ø¨Ù„' },
                        { k: ['Ø§Ù„Ø¯ÙŠÙˆØ§Ù†ÙŠØ©','Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©','Qadisiyah','Diwaniyah'], v: 'Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©' },
                        { k: ['Ø§Ù„Ù†Ø§ØµØ±ÙŠØ©','Ø°ÙŠ Ù‚Ø§Ø±','Dhi Qar','Nasiriyah'], v: 'Ø°ÙŠ Ù‚Ø§Ø±' },
                        { k: ['Ø§Ù„Ø³Ù…Ø§ÙˆØ©','Ø§Ù„Ù…Ø«Ù†Ù‰','Muthanna','Samawah'], v: 'Ø§Ù„Ù…Ø«Ù†Ù‰' },
                        { k: ['Ø§Ù„Ø¹Ù…Ø§Ø±Ø©','Ù…ÙŠØ³Ø§Ù†','Maysan','Amarah'], v: 'Ù…ÙŠØ³Ø§Ù†' },
                        { k: ['Ø§Ù„ÙƒÙˆØª','ÙˆØ§Ø³Ø·','Wasit','Kut'], v: 'ÙˆØ§Ø³Ø·' },
                    ];
                    const found = map.find(m => m.k.some(alias => cityText.includes(alias)));
                    if (found) {
                        citySelect.value = found.v;
                    }
                }
            } else {
                hint.textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª. ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¹Ù†ÙˆØ§Ù† Ù†ØµÙŠ.';
            }
        } catch (_) {
            hint.textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª. ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¹Ù†ÙˆØ§Ù† Ù†ØµÙŠ.';
        }
    } catch (e) {
        showToast('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'error');
        hint.classList.add('hidden');
    } finally {
        btn && (btn.disabled = false);
    }
}

// Currency conversion function with real-time rates
async function convertCurrency() {
    const priceInput = document.getElementById('price');
    const currencySelect = document.getElementById('currency');
    const currentPrice = parseFloat(priceInput.value);
    const currentCurrency = currencySelect.value;
    
    if (!currentPrice || currentPrice <= 0) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
        return;
    }
    
    // Show loading state
    const convertBtn = event.target;
    const originalText = convertBtn.innerHTML;
    convertBtn.innerHTML = '<i class="fas fa-spinner fa-spin ml-1"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...';
    convertBtn.disabled = true;
    
    try {
        // Try to get real-time exchange rate
        let exchangeRate = 0.00068; // Default fallback rate
        
        try {
            // You can use a free API like exchangerate-api.com or fixer.io
            const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
            if (response.ok) {
                const data = await response.json();
                exchangeRate = data.rates.IQD ? 1 / data.rates.IQD : 0.00068;
            }
        } catch (apiError) {
            console.log('Using fallback exchange rate');
        }
        
        let convertedPrice;
        let newCurrency;
        
        if (currentCurrency === 'IQD') {
            // Convert from IQD to USD
            convertedPrice = currentPrice * exchangeRate;
            newCurrency = 'USD';
        } else if (currentCurrency === 'USD') {
            // Convert from USD to IQD
            convertedPrice = currentPrice / exchangeRate;
            newCurrency = 'IQD';
        } else {
            // For EUR, convert to USD first, then to IQD
            const eurToUsd = 1.1; // Approximate rate
            const usdPrice = currentPrice * eurToUsd;
            convertedPrice = usdPrice / exchangeRate;
            newCurrency = 'IQD';
        }
        
        // Update the form
        priceInput.value = convertedPrice.toFixed(2);
        currencySelect.value = newCurrency;
        
        // Show conversion info
        const fromCurrency = currentCurrency === 'IQD' ? 'Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ' : 
                            currentCurrency === 'USD' ? 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ' : 'ÙŠÙˆØ±Ùˆ';
        const toCurrency = newCurrency === 'IQD' ? 'Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ' : 
                          newCurrency === 'USD' ? 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ' : 'ÙŠÙˆØ±Ùˆ';
        
        showToast(`ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${fromCurrency} Ø¥Ù„Ù‰ ${toCurrency} (Ø§Ù„Ø³Ø¹Ø±: ${convertedPrice.toFixed(2)})`, 'success');
        
    } catch (error) {
        console.error('Currency conversion error:', error);
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø©', 'error');
    } finally {
        // Reset button state
        convertBtn.innerHTML = originalText;
        convertBtn.disabled = false;
    }
}

// Add modal event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Close modal when clicking outside
    document.getElementById('imageModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeImageModal();
        }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeImageModal();
        }
    });
});

// Form submission (multipart/form-data)
document.getElementById('addProductForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const form = e.target;
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    // Show loading state
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';
    submitBtn.disabled = true;
    
    try {
        const fd = new FormData();
        fd.append('title', document.getElementById('title').value || '');
        fd.append('description', document.getElementById('description').value || '');
        fd.append('price', document.getElementById('price').value || '0');
        fd.append('currency', document.getElementById('currency').value || 'IQD');
        fd.append('category', document.getElementById('category').value || '');
        fd.append('city', document.getElementById('city').value || '');
        fd.append('location', document.getElementById('location').value || '');
        fd.append('condition', document.getElementById('condition').value || '');
        fd.append('color', document.getElementById('color').value || '');

        const i1 = document.getElementById('image1').files[0];
        const i2 = document.getElementById('image2').files[0];
        const i3 = document.getElementById('image3').files[0];
        if (i1) fd.append('image1', i1);
        if (i2) fd.append('image2', i2);
        if (i3) fd.append('image3', i3);

        const response = await fetch('/web/products', { method: 'POST', body: fd });
        const result = await response.json();
        
        if (response.ok) {
            showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            setTimeout(() => { window.location.href = '/products/my'; }, 1000);
        } else {
            showToast(result.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬', 'error');
        }
    } catch (error) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
        console.error('Error:', error);
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});

// Toast notification function
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all duration-300 transform translate-x-full ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 
        'bg-blue-500'
    }`;
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.remove('translate-x-full');
    }, 100);
    
    setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 300);
    }, 3000);
}
</script>
{% endblock %}
